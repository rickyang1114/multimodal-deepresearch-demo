<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FAO's Three-Tiered Framework for Fish Stock Assessment</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-color: #f9f9f9;
      }

      .visualization-container {
        width: 850px;
        height: 680px;
        background-color: white;
        position: relative;
        padding: 20px;
        box-sizing: border-box;
      }

      .title {
        font-size: 18pt;
        font-weight: bold;
        color: #1a3a5f; /* midnight navy */
        text-align: center;
        margin-bottom: 5px;
      }

      .subtitle {
        font-size: 12pt;
        color: #7d8ca3; /* slate gray */
        text-align: center;
        margin-bottom: 25px;
      }

      .tiers-container {
        display: flex;
        justify-content: space-between;
        height: 450px;
        position: relative;
      }

      .tier-column {
        width: 30%;
        border: 1px solid #7d8ca3;
        border-radius: 8px;
        padding: 15px;
        box-sizing: border-box;
        position: relative;
      }

      .tier-1 {
        background-color: #4abdac;
        color: white;
      }

      .tier-2 {
        background-color: #7d8ca3;
        color: white;
      }

      .tier-3 {
        background-color: #ededed;
        color: #333;
      }

      .tier-icon {
        text-align: center;
        font-size: 24px;
        margin-bottom: 10px;
        color: #1a3a5f;
      }

      .tier-title {
        font-size: 16pt;
        font-weight: bold;
        color: #1a3a5f;
        text-align: center;
        margin-bottom: 15px;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .section-header {
        font-size: 12pt;
        font-weight: bold;
        color: #1a3a5f;
        margin-top: 12px;
        margin-bottom: 5px;
      }

      .section-content {
        font-size: 10pt;
        margin-bottom: 10px;
      }

      .highlight {
        font-family: 'Georgia', serif;
        font-size: 14pt;
        font-weight: bold;
      }

      .tier-1 .highlight,
      .tier-2 .highlight {
        color: #fff;
        text-shadow: 0 0 3px #1a3a5f;
      }

      .tier-3 .highlight {
        color: #1a3a5f;
      }

      .timeline-container {
        position: relative;
        margin-top: 50px;
        height: 120px;
        width: 100%;
      }

      .timeline-label {
        font-size: 14pt;
        font-weight: bold;
        color: #1a3a5f;
        margin-bottom: 15px;
        text-align: center;
      }

      .glossary {
        font-size: 9pt;
        color: #666;
        font-style: italic;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <div class="visualization-container">
      <div class="title">FAO's Three-Tiered Framework for Fish Stock Assessment</div>
      <div class="subtitle">Addressing data gaps through a standardized global methodology</div>

      <div class="tiers-container" id="tiers-container">
        <!-- Tier columns will be added by D3 -->
      </div>

      <div class="timeline-container" id="timeline-container">
        <!-- Timeline will be added by D3 -->
      </div>
    </div>

    <script>
      // Data for the three tiers
      const tiersData = [
        {
          id: 1,
          title: 'Tier 1: Formal Stock Assessments',
          icon: 'fa-chart-line',
          color: '#4ABDAC',
          methodology:
            'Quantitative models using time series data on catch, effort, and biological parameters',
          dataRequirements:
            'High: Requires long-term monitoring data, surveys, age/size composition, and biological reference points',
          examples:
            'Most stocks in North America, Europe, and Oceania; major tuna stocks under RFMO* management',
          coverage: 'Approximately 25% of global commercially important stocks',
        },
        {
          id: 2,
          title: 'Tier 2: Semi-Formal Models',
          icon: 'fa-chart-bar',
          color: '#7D8CA3',
          methodology:
            'Data-limited assessment methods such as Sraplus, using catch trends and auxiliary data',
          dataRequirements:
            'Medium: Requires catch time series and at least one auxiliary indicator (e.g., CPUE*, effort data)',
          examples:
            'Many stocks in Southeast Asia, Latin America, and parts of Africa with partial monitoring',
          coverage: 'Target expansion to cover additional 35-40% of global stocks',
        },
        {
          id: 3,
          title: 'Tier 3: Weight-of-Evidence Approaches',
          icon: 'fa-clipboard-check',
          color: '#EDEDED',
          methodology:
            'Qualitative assessment using catch trends, expert knowledge, and ecosystem indicators',
          dataRequirements:
            'Low: Usable with minimal data beyond catch statistics and limited biological information',
          examples:
            'Data-poor fisheries in developing regions; small-scale and artisanal fisheries',
          coverage: 'Remaining 35-40% of global stocks with limited or no assessment history',
        },
      ]

      // Timeline milestones
      const timelineData = [
        { year: 2021, label: 'Partnership launch under Blue Transformation initiative' },
        { year: 2023, label: 'Pilot roll-out in Areas 31 and 37' },
        { year: 2025, label: 'Updated stock index and global assessment' },
        { year: 2026, label: 'Partnership completion with expanded global coverage' },
      ]

      // Create tier columns
      const tiersContainer = d3.select('#tiers-container')

      // Create SVG for arrows first so it's behind the columns
      const arrowsSvg = tiersContainer
        .append('svg')
        .attr('width', '100%')
        .attr('height', '100%')
        .style('position', 'absolute')
        .style('top', 0)
        .style('left', 0)
        .style('z-index', 1)

      // Add arrow marker definition
      arrowsSvg
        .append('defs')
        .append('marker')
        .attr('id', 'tier-arrow')
        .attr('viewBox', '0 -5 10 10')
        .attr('refX', 8)
        .attr('refY', 0)
        .attr('markerWidth', 6)
        .attr('markerHeight', 6)
        .attr('orient', 'auto')
        .append('path')
        .attr('d', 'M0,-5L10,0L0,5')
        .attr('fill', '#1a3a5f')

      const tierColumns = tiersContainer
        .selectAll('.tier-column')
        .data(tiersData)
        .enter()
        .append('div')
        .attr('class', (d) => `tier-column tier-${d.id}`)
        .style('background-color', (d) => d.color)
        .style('z-index', 2)
        .attr('id', (d) => `tier-${d.id}`)

      // Add icons
      tierColumns
        .append('div')
        .attr('class', 'tier-icon')
        .html((d) => `<i class="fas ${d.icon}"></i>`)

      // Add titles
      tierColumns
        .append('div')
        .attr('class', 'tier-title')
        .text((d) => d.title)

      // Add methodology section
      tierColumns.append('div').attr('class', 'section-header').text('Methodology')

      tierColumns
        .append('div')
        .attr('class', 'section-content')
        .text((d) => d.methodology)

      // Add data requirements section
      tierColumns.append('div').attr('class', 'section-header').text('Data Requirements')

      tierColumns
        .append('div')
        .attr('class', 'section-content')
        .text((d) => d.dataRequirements)

      // Add examples section
      tierColumns.append('div').attr('class', 'section-header').text('Examples')

      tierColumns
        .append('div')
        .attr('class', 'section-content')
        .text((d) => d.examples)

      // Add coverage section
      tierColumns.append('div').attr('class', 'section-header').text('Coverage')

      // Consistent highlighting of percentages
      tierColumns
        .append('div')
        .attr('class', 'section-content')
        .html((d) => {
          if (d.id === 1) {
            return d.coverage.replace(/(\d+%)/g, '<span class="highlight">$1</span>')
          } else if (d.id === 2) {
            return d.coverage.replace(/(35-40%)/g, '<span class="highlight">$1</span>')
          } else if (d.id === 3) {
            return "Remaining <span class='highlight'>35-40%</span> of global stocks with limited or no assessment history"
          }
          return d.coverage
        })

      // Add glossary notes for abbreviations
      const tier1 = d3.select('#tier-1')
      tier1
        .append('div')
        .attr('class', 'glossary')
        .html('*RFMO: Regional Fisheries Management Organization')

      const tier2 = d3.select('#tier-2')
      tier2.append('div').attr('class', 'glossary').html('*CPUE: Catch Per Unit Effort')

      // Draw connecting arrows between tiers
      // We'll draw these directly with fixed positions since we know the layout

      // Arrow from Tier 1 to Tier 2
      arrowsSvg
        .append('line')
        .attr('x1', '30%') // End of Tier 1
        .attr('y1', '50%') // Middle height
        .attr('x2', '35%') // Before start of Tier 2
        .attr('y2', '50%')
        .attr('stroke', '#1a3a5f')
        .attr('stroke-width', 2)
        .attr('marker-end', 'url(#tier-arrow)')

      // Arrow from Tier 2 to Tier 3
      arrowsSvg
        .append('line')
        .attr('x1', '65%') // End of Tier 2
        .attr('y1', '50%') // Middle height
        .attr('x2', '70%') // Before start of Tier 3
        .attr('y2', '50%')
        .attr('stroke', '#1a3a5f')
        .attr('stroke-width', 2)
        .attr('marker-end', 'url(#tier-arrow)')

      // Create timeline
      const timelineContainer = d3.select('#timeline-container')

      // Add timeline label
      timelineContainer
        .append('div')
        .attr('class', 'timeline-label')
        .text('Implementation Timeline')

      // Create SVG for timeline
      const timelineSvg = timelineContainer.append('svg').attr('width', '100%').attr('height', 100)

      // Timeline parameters
      const timelineMargin = { left: 40, right: 40 }
      const timelineWidth = 770 - timelineMargin.left - timelineMargin.right
      const timelineHeight = 40

      // Create scale for timeline
      const timelineScale = d3.scaleLinear().domain([2021, 2026]).range([0, timelineWidth])

      // Add arrow marker definition for timeline
      timelineSvg
        .append('defs')
        .append('marker')
        .attr('id', 'timeline-arrow')
        .attr('viewBox', '0 -5 10 10')
        .attr('refX', 8)
        .attr('refY', 0)
        .attr('markerWidth', 6)
        .attr('markerHeight', 6)
        .attr('orient', 'auto')
        .append('path')
        .attr('d', 'M0,-5L10,0L0,5')
        .attr('fill', '#1a3a5f')

      // Draw timeline line
      timelineSvg
        .append('line')
        .attr('x1', timelineMargin.left)
        .attr('y1', timelineHeight)
        .attr('x2', timelineWidth + timelineMargin.left - 10)
        .attr('y2', timelineHeight)
        .attr('stroke', '#1a3a5f')
        .attr('stroke-width', 2)
        .attr('marker-end', 'url(#timeline-arrow)')

      // Add milestone nodes
      const milestones = timelineSvg
        .selectAll('.milestone')
        .data(timelineData)
        .enter()
        .append('g')
        .attr('class', 'milestone')
        .attr('transform', (d) => {
          const x = timelineScale(d.year) + timelineMargin.left
          return `translate(${x}, ${timelineHeight})`
        })

      milestones.append('circle').attr('r', 5).attr('fill', '#1a3a5f')

      // Add year labels with larger font
      milestones
        .append('text')
        .attr('y', 20)
        .attr('text-anchor', 'middle')
        .attr('font-size', '12pt')
        .attr('font-weight', 'bold')
        .attr('font-family', 'Georgia, serif')
        .attr('fill', '#1a3a5f')
        .text((d) => d.year)

      // Improved milestone descriptions with better positioning
      // First milestone (2021)
      timelineSvg
        .append('text')
        .attr('x', timelineScale(2021) + timelineMargin.left)
        .attr('y', timelineHeight - 15)
        .attr('text-anchor', 'middle')
        .attr('font-size', '9pt')
        .attr('fill', '#333')
        .text('Partnership launch')

      // Second milestone (2023)
      timelineSvg
        .append('text')
        .attr('x', timelineScale(2023) + timelineMargin.left)
        .attr('y', timelineHeight - 15)
        .attr('text-anchor', 'middle')
        .attr('font-size', '9pt')
        .attr('fill', '#333')
        .text('Pilot roll-out')

      // Third milestone (2025)
      timelineSvg
        .append('text')
        .attr('x', timelineScale(2025) + timelineMargin.left)
        .attr('y', timelineHeight - 15)
        .attr('text-anchor', 'middle')
        .attr('font-size', '9pt')
        .attr('fill', '#333')
        .text('Updated stock index')

      // Fourth milestone (2026)
      timelineSvg
        .append('text')
        .attr('x', timelineScale(2026) + timelineMargin.left)
        .attr('y', timelineHeight - 15)
        .attr('text-anchor', 'middle')
        .attr('font-size', '9pt')
        .attr('fill', '#333')
        .text('Partnership completion')
    </script>
  </body>
</html>
