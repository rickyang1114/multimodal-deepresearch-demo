<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Impact of Catch Shares on the U.S. West Coast Groundfish Fishery</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
        }
        
        .visualization-container {
            width: 1000px;
            padding: 20px;
        }
        
        .title {
            font-size: 18pt;
            font-weight: bold;
            color: #1A3A5A; /* midnight navy */
            text-align: center;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 12pt;
            color: #7D8CA3; /* slate gray */
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section-header {
            font-size: 14pt;
            font-weight: bold;
            color: #1A3A5A; /* midnight navy */
            text-align: center;
            margin-bottom: 10px;
        }
        
        .chart-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .chart-section {
            width: 46%;
        }
        
        .arrow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 8%;
        }
        
        .arrow {
            color: #7D8CA3;
            font-size: 32px;
        }
        
        .explanation-box {
            background-color: #EDEDED;
            border: 1px solid #7D8CA3;
            padding: 15px;
            margin: 10px 0 20px 0;
            font-size: 10pt;
            color: #333;
            line-height: 1.4;
        }
        
        .explanation-box .highlight {
            font-weight: bold;
            font-family: 'Georgia', serif;
            color: #1A3A5A;
            font-size: 11pt;
        }
        
        .source {
            font-size: 8pt;
            color: #A9B5C7; /* light slate gray */
            text-align: right;
        }
        
        .axis-label {
            font-size: 11pt;
            font-weight: 500;
            color: #555;
            text-anchor: middle;
        }
        
        .tick text {
            font-size: 9pt;
            color: #555;
        }
        
        .overall-ratio {
            font-size: 11pt;
            font-weight: bold;
            font-family: 'Georgia', serif;
        }
        
        .pre-ifq {
            color: #7D8CA3; /* slate gray */
        }
        
        .post-ifq {
            color: #4ABDAC; /* teal */
        }
    </style>
</head>
<body>
    <div class="visualization-container">
        <div class="title">Impact of Catch Shares on the U.S. West Coast Groundfish Fishery</div>
        <div class="subtitle">Catch-to-TAC ratios before and after Individual Fishing Quota (IFQ) implementation</div>
        
        <div class="chart-container">
            <div class="chart-section">
                <div class="section-header">Pre-IFQ (2008-2010)</div>
                <div id="pre-ifq-chart"></div>
            </div>
            
            <div class="arrow-container">
                <i class="fas fa-arrow-right arrow"></i>
            </div>
            
            <div class="chart-section">
                <div class="section-header">Post-IFQ (2011-2013)</div>
                <div id="post-ifq-chart"></div>
            </div>
        </div>
        
        <div class="explanation-box">
            Implementation of catch shares led to a significant reduction in catch-to-TAC ratios from 
            <span class="highlight">0.41</span> to <span class="highlight">0.29</span> 
            (<span class="highlight">p = 0.001</span>), indicating improved quota management. 
            The largest improvements were in constraining species like Yelloweye rockfish, 
            which limits the overall fishery due to extremely low TACs 
            (<span class="highlight">0.6 t</span>).
        </div>
        
        <div class="source">Source: Based on Kuriyama et al. (2016)</div>
    </div>

    <script>
        // Data preparation
        const preIFQData = [
            { species: "Dover sole", ratio: 0.31 },
            { species: "Lingcod", ratio: 0.24 },
            { species: "Pacific cod", ratio: 0.67 },
            { species: "Sablefish", ratio: 0.92 },
            { species: "Shortspine thornyhead", ratio: 0.63 },
            { species: "Widow rockfish", ratio: 0.38 },
            { species: "Yelloweye rockfish", ratio: 0.98 },
            { species: "Yellowtail rockfish", ratio: 0.54 }
        ];

        const postIFQData = [
            { species: "Dover sole", ratio: 0.25 },
            { species: "Lingcod", ratio: 0.16 },
            { species: "Pacific cod", ratio: 0.39 },
            { species: "Sablefish", ratio: 0.81 },
            { species: "Shortspine thornyhead", ratio: 0.49 },
            { species: "Widow rockfish", ratio: 0.23 },
            { species: "Yelloweye rockfish", ratio: 0.72 },
            { species: "Yellowtail rockfish", ratio: 0.31 }
        ];

        const preIFQOverall = 0.41;
        const postIFQOverall = 0.29;

        // Chart dimensions - increased width to accommodate labels better
        const margin = { top: 40, right: 50, bottom: 120, left: 70 };
        const width = 450 - margin.left - margin.right;
        const height = 450 - margin.top - margin.bottom;

        // Create the SVG for Pre-IFQ chart
        const preIFQSvg = d3.select("#pre-ifq-chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Create the SVG for Post-IFQ chart
        const postIFQSvg = d3.select("#post-ifq-chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // X scale for both charts - increased padding for better spacing
        const xPreIFQ = d3.scaleBand()
            .domain(preIFQData.map(d => d.species))
            .range([0, width])
            .padding(0.5);

        const xPostIFQ = d3.scaleBand()
            .domain(postIFQData.map(d => d.species))
            .range([0, width])
            .padding(0.5);

        // Y scale for both charts
        const y = d3.scaleLinear()
            .domain([0, 1.0])
            .range([height, 0]);

        // Add X axis to Pre-IFQ chart with improved label positioning
        preIFQSvg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xPreIFQ))
            .selectAll("text")
            .attr("transform", "rotate(-45)")
            .style("text-anchor", "end")
            .attr("dx", "-0.8em")
            .attr("dy", "0.15em")
            .style("font-size", "9pt")
            .style("fill", "#333");

        // Add X axis to Post-IFQ chart with improved label positioning
        postIFQSvg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xPostIFQ))
            .selectAll("text")
            .attr("transform", "rotate(-45)")
            .style("text-anchor", "end")
            .attr("dx", "-0.8em")
            .attr("dy", "0.15em")
            .style("font-size", "9pt")
            .style("fill", "#333");

        // Add Y axis to Pre-IFQ chart with more visible ticks
        preIFQSvg.append("g")
            .call(d3.axisLeft(y)
                .tickSize(-3)
                .tickFormat(d => d.toFixed(1))
                .ticks(6))
            .call(g => g.select(".domain").attr("stroke-width", 1))
            .call(g => g.selectAll(".tick line").attr("stroke-width", 0.5));

        // Add Y axis to Post-IFQ chart with more visible ticks
        postIFQSvg.append("g")
            .call(d3.axisLeft(y)
                .tickSize(-3)
                .tickFormat(d => d.toFixed(1))
                .ticks(6))
            .call(g => g.select(".domain").attr("stroke-width", 1))
            .call(g => g.selectAll(".tick line").attr("stroke-width", 0.5));

        // Add Y axis label to Pre-IFQ chart - improved visibility and positioning
        preIFQSvg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("y", -margin.left + 20)
            .attr("x", -height / 2)
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Catch-to-TAC ratio (0-1.0)");
            
        // No need for Y axis label on Post-IFQ chart to reduce redundancy

        // Add horizontal gridlines to Pre-IFQ chart - improved visibility
        preIFQSvg.append("g")
            .attr("class", "grid")
            .selectAll("line")
            .data(y.ticks(6))
            .enter()
            .append("line")
            .attr("x1", 0)
            .attr("x2", width)
            .attr("y1", d => y(d))
            .attr("y2", d => y(d))
            .attr("stroke", "#EDEDED")
            .attr("stroke-width", 0.75);

        // Add horizontal gridlines to Post-IFQ chart - improved visibility
        postIFQSvg.append("g")
            .attr("class", "grid")
            .selectAll("line")
            .data(y.ticks(6))
            .enter()
            .append("line")
            .attr("x1", 0)
            .attr("x2", width)
            .attr("y1", d => y(d))
            .attr("y2", d => y(d))
            .attr("stroke", "#EDEDED")
            .attr("stroke-width", 0.75);

        // Add bars to Pre-IFQ chart - adjusted width for better spacing
        preIFQSvg.selectAll(".bar")
            .data(preIFQData)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", d => xPreIFQ(d.species) + (xPreIFQ.bandwidth() - 20) / 2)
            .attr("width", 20)
            .attr("y", d => y(d.ratio))
            .attr("height", d => height - y(d.ratio))
            .attr("fill", "#7D8CA3");

        // Add bars to Post-IFQ chart - adjusted width for better spacing
        postIFQSvg.selectAll(".bar")
            .data(postIFQData)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", d => xPostIFQ(d.species) + (xPostIFQ.bandwidth() - 20) / 2)
            .attr("width", 20)
            .attr("y", d => y(d.ratio))
            .attr("height", d => height - y(d.ratio))
            .attr("fill", "#4ABDAC");

        // Add ratio values above bars for Pre-IFQ - improved positioning
        preIFQSvg.selectAll(".ratio-label")
            .data(preIFQData)
            .enter()
            .append("text")
            .attr("class", "ratio-label")
            .attr("x", d => xPreIFQ(d.species) + xPreIFQ.bandwidth() / 2)
            .attr("y", d => y(d.ratio) - 5)
            .attr("text-anchor", "middle")
            .style("font-size", "9pt")
            .style("font-weight", "500")
            .style("fill", "#7D8CA3")
            .text(d => d.ratio.toFixed(2));

        // Add ratio values above bars for Post-IFQ - improved positioning
        postIFQSvg.selectAll(".ratio-label")
            .data(postIFQData)
            .enter()
            .append("text")
            .attr("class", "ratio-label")
            .attr("x", d => xPostIFQ(d.species) + xPostIFQ.bandwidth() / 2)
            .attr("y", d => y(d.ratio) - 5)
            .attr("text-anchor", "middle")
            .style("font-size", "9pt")
            .style("font-weight", "500")
            .style("fill", "#4ABDAC")
            .text(d => d.ratio.toFixed(2));

        // Add horizontal reference line for Pre-IFQ overall ratio
        preIFQSvg.append("line")
            .attr("x1", 0)
            .attr("x2", width)
            .attr("y1", y(preIFQOverall))
            .attr("y2", y(preIFQOverall))
            .attr("stroke", "#7D8CA3")
            .attr("stroke-width", 1)
            .attr("stroke-dasharray", "4,4");

        // Add horizontal reference line for Post-IFQ overall ratio
        postIFQSvg.append("line")
            .attr("x1", 0)
            .attr("x2", width)
            .attr("y1", y(postIFQOverall))
            .attr("y2", y(postIFQOverall))
            .attr("stroke", "#4ABDAC")
            .attr("stroke-width", 1)
            .attr("stroke-dasharray", "4,4");

        // Add overall ratio label for Pre-IFQ - improved size and positioning
        preIFQSvg.append("rect")
            .attr("x", width - 55)
            .attr("y", y(preIFQOverall) - 12)
            .attr("width", 55)
            .attr("height", 24)
            .attr("fill", "white")
            .attr("stroke", "#7D8CA3")
            .attr("stroke-width", 0.5);

        preIFQSvg.append("text")
            .attr("class", "overall-ratio pre-ifq")
            .attr("x", width - 27.5)
            .attr("y", y(preIFQOverall) + 6)
            .attr("text-anchor", "middle")
            .text(preIFQOverall.toFixed(2));

        // Add overall ratio label for Post-IFQ - improved size and positioning
        postIFQSvg.append("rect")
            .attr("x", width - 55)
            .attr("y", y(postIFQOverall) - 12)
            .attr("width", 55)
            .attr("height", 24)
            .attr("fill", "white")
            .attr("stroke", "#4ABDAC")
            .attr("stroke-width", 0.5);

        postIFQSvg.append("text")
            .attr("class", "overall-ratio post-ifq")
            .attr("x", width - 27.5)
            .attr("y", y(postIFQOverall) + 6)
            .attr("text-anchor", "middle")
            .text(postIFQOverall.toFixed(2));
    </script>
</body>
</html>