<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Global Policy Initiatives to Address Fisheries Overexploitation</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: 'Arial', sans-serif;
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        background-color: #fafafa;
      }

      .visualization-container {
        width: 900px;
        height: 800px;
        background-color: white;
        position: relative;
        box-sizing: border-box;
        padding: 20px;
      }

      .title {
        font-size: 18pt;
        font-weight: bold;
        color: #2a3045;
        text-align: center;
        margin-top: 10px;
        margin-bottom: 5px;
      }

      .subtitle {
        font-size: 12pt;
        color: #7d8ca3;
        text-align: center;
        margin-bottom: 30px;
      }

      .category-label {
        font-size: 14pt;
        font-weight: bold;
        position: absolute;
        left: 20px;
      }

      .timeline {
        stroke: #2a3045;
        stroke-width: 2px;
      }

      .gridline {
        stroke: #ededed;
        stroke-width: 0.5px;
      }

      .major-node {
        fill: #2a3045;
      }

      .minor-node {
        fill: #7d8ca3;
      }

      .year-label {
        font-size: 10pt;
        fill: #2a3045;
        text-anchor: middle;
        font-weight: 500;
      }

      .event-node {
        r: 6;
      }

      .event-node.subsidy {
        fill: #4abdac;
      }

      .event-node.monitoring {
        fill: #7d8ca3;
      }

      .event-node.recovery {
        fill: #2a3045;
      }

      .event-box {
        rx: 4;
        ry: 4;
        fill: white;
        stroke-width: 1px;
      }

      .event-box.subsidy {
        stroke: #4abdac;
      }

      .event-box.monitoring {
        stroke: #7d8ca3;
      }

      .event-box.recovery {
        stroke: #2a3045;
      }

      .event-connector {
        stroke-width: 0.75px;
        fill: none;
      }

      .event-connector.subsidy {
        stroke: #4abdac;
      }

      .event-connector.monitoring {
        stroke: #7d8ca3;
      }

      .event-connector.recovery {
        stroke: #2a3045;
      }

      .event-text {
        font-size: 10pt;
        fill: #333333;
      }

      .event-year {
        font-weight: bold;
      }

      .milestones-box {
        fill: #ededed;
        stroke: #7d8ca3;
        stroke-width: 1px;
        rx: 4;
        ry: 4;
      }

      .milestone-title {
        font-size: 12pt;
        font-weight: bold;
        fill: #2a3045;
      }

      .milestone-text {
        font-size: 10pt;
        fill: #333333;
      }

      .milestone-bullet {
        r: 4;
      }

      .source-text {
        font-size: 8pt;
        fill: #7d8ca3;
        text-anchor: middle;
      }

      .key-number {
        font-family: 'Georgia', serif;
        font-size: 11pt;
        font-weight: bold;
        fill: #2a3045;
      }
    </style>
  </head>
  <body>
    <div class="visualization-container">
      <div class="title">Global Policy Initiatives to Address Fisheries Overexploitation</div>
      <div class="subtitle">Timeline of key commitments, agreements, and targets: 2015-2030</div>
      <svg width="860" height="720"></svg>
    </div>

    <script>
      // SVG setup
      const svg = d3.select('svg')
      const margin = { top: 20, right: 40, bottom: 80, left: 60 }
      const width = +svg.attr('width') - margin.left - margin.right
      const height = +svg.attr('height') - margin.top - margin.bottom
      const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`)

      // Time scale
      const timeScale = d3.scaleLinear().domain([2015, 2030]).range([0, width])

      // Timeline position
      const timelineY = height / 2

      // Draw timeline
      g.append('line')
        .attr('class', 'timeline')
        .attr('x1', 0)
        .attr('y1', timelineY)
        .attr('x2', width)
        .attr('y2', timelineY)

      // Draw gridlines and year markers
      const majorYears = [2015, 2020, 2025, 2030]
      const allYears = d3.range(2015, 2031)

      // Gridlines
      majorYears.forEach((year) => {
        g.append('line')
          .attr('class', 'gridline')
          .attr('x1', timeScale(year))
          .attr('y1', 0)
          .attr('x2', timeScale(year))
          .attr('y2', height - 100)
      })

      // Year nodes
      allYears.forEach((year) => {
        const isMajor = majorYears.includes(year)

        g.append('circle')
          .attr('class', isMajor ? 'major-node' : 'minor-node')
          .attr('cx', timeScale(year))
          .attr('cy', timelineY)
          .attr('r', isMajor ? 8 : 4)

        if (isMajor) {
          g.append('text')
            .attr('class', 'year-label')
            .attr('x', timeScale(year))
            .attr('y', timelineY + 30)
            .text(year)
        }
      })

      // Category labels
      const categories = [
        { name: 'Subsidy Reform', y: 80, class: 'subsidy', color: '#4ABDAC' },
        { name: 'Recovery Targets', y: timelineY - 20, class: 'recovery', color: '#2A3045' },
        {
          name: 'Monitoring & Assessment',
          y: timelineY + 180,
          class: 'monitoring',
          color: '#7D8CA3',
        },
      ]

      categories.forEach((cat) => {
        g.append('text')
          .attr('class', 'category-label')
          .attr('x', 0)
          .attr('y', cat.y)
          .attr('fill', cat.color)
          .text(cat.name)
      })

      // Event data
      const events = [
        // Subsidy Reform
        {
          year: 2015,
          category: 'subsidy',
          position: 'top',
          offsetY: -200,
          text: 'SDG Target 14.6 - Prohibit harmful fisheries subsidies',
          width: 280,
          height: 50,
        },
        {
          year: 2022,
          category: 'subsidy',
          position: 'top',
          offsetY: -200,
          text: 'WTO Agreement on Fisheries Subsidies banning subsidies contributing to IUU fishing, overfished stocks, and unregulated high seas fishing',
          width: 280,
          height: 80,
        },
        {
          year: 2028,
          category: 'subsidy',
          position: 'top',
          offsetY: -200,
          text: 'Target date for full WTO agreement implementation (requires 109 member ratifications)',
          width: 280,
          height: 60,
        },

        // Monitoring & Assessment
        {
          year: 2021,
          category: 'monitoring',
          position: 'bottom',
          offsetY: 210,
          text: 'FAO Blue Transformation partnership launch',
          width: 240,
          height: 40,
        },
        {
          year: 2023,
          category: 'monitoring',
          position: 'bottom',
          offsetY: 210,
          text: 'FAO three-tiered assessment framework pilot in Areas 31 and 37',
          width: 240,
          height: 50,
        },
        {
          year: 2025,
          category: 'monitoring',
          position: 'bottom',
          offsetY: 210,
          text: 'Updated state of stocks index and global assessment release (June 30)',
          width: 240,
          height: 60,
        },
        {
          year: 2026,
          category: 'monitoring',
          position: 'bottom',
          offsetY: 210,
          text: 'Blue Transformation partnership completion with expanded coverage (June 30)',
          width: 240,
          height: 60,
        },

        // Recovery Targets
        {
          year: 2015,
          category: 'recovery',
          position: 'bottom',
          offsetY: 40,
          text: 'SDG Target 14.4 - Restore fish stocks to sustainable levels by 2020',
          width: 240,
          height: 50,
        },
        {
          year: 2020,
          category: 'recovery',
          position: 'bottom',
          offsetY: 40,
          text: 'Initial SDG 14.4 target date (not achieved)',
          width: 240,
          height: 40,
        },
        {
          year: 2021,
          category: 'recovery',
          position: 'top',
          offsetY: -90,
          text: 'CBD draft goal to reverse biodiversity loss by 2030',
          width: 240,
          height: 50,
        },
        {
          year: 2024,
          category: 'recovery',
          position: 'bottom',
          offsetY: 40,
          text: 'Revised methodology for SDG 14.4.1 indicator reporting',
          width: 240,
          height: 50,
        },
        {
          year: 2030,
          category: 'recovery',
          position: 'top',
          offsetY: -90,
          text: 'FAO Blue Transformation target for 100% sustainable fisheries',
          width: 240,
          height: 50,
        },
      ]

      // Draw event nodes and boxes
      events.forEach((event) => {
        const x = timeScale(event.year)
        const y = timelineY
        const boxY = event.position === 'top' ? y + event.offsetY : y + event.offsetY
        const boxHeight = event.height
        const boxWidth = event.width
        const boxX = x - boxWidth / 2

        // Event node on timeline
        g.append('circle').attr('class', `event-node ${event.category}`).attr('cx', x).attr('cy', y)

        // Event box
        g.append('rect')
          .attr('class', `event-box ${event.category}`)
          .attr('x', boxX)
          .attr('y', boxY)
          .attr('width', boxWidth)
          .attr('height', boxHeight)

        // Connector line
        const connectorPath =
          event.position === 'top'
            ? `M${x},${y} L${x},${boxY + boxHeight}`
            : `M${x},${y} L${x},${boxY}`

        g.append('path').attr('class', `event-connector ${event.category}`).attr('d', connectorPath)

        // Event text - using foreignObject for better text wrapping
        const textGroup = g
          .append('foreignObject')
          .attr('x', boxX + 10)
          .attr('y', boxY + 10)
          .attr('width', boxWidth - 20)
          .attr('height', boxHeight - 20)

        const div = textGroup
          .append('xhtml:div')
          .style('font-size', '10px')
          .style('font-family', "'Arial', sans-serif")
          .style('overflow', 'hidden')
          .style('width', '100%')
          .style('height', '100%')

        div.html(`<span style="font-weight: bold;">${event.year}:</span> ${event.text}`)
      })

      // 2030 Milestones box
      const milestonesBoxWidth = 760
      const milestonesBoxHeight = 110
      const milestonesBoxX = (width - milestonesBoxWidth) / 2
      const milestonesBoxY = height - 90

      g.append('rect')
        .attr('class', 'milestones-box')
        .attr('x', milestonesBoxX)
        .attr('y', milestonesBoxY)
        .attr('width', milestonesBoxWidth)
        .attr('height', milestonesBoxHeight)

      g.append('text')
        .attr('class', 'milestone-title')
        .attr('x', milestonesBoxX + 20)
        .attr('y', milestonesBoxY + 25)
        .text('Key 2030 Targets:')

      const milestones = [
        { text: '100% of fisheries managed sustainably (FAO)', category: 'recovery' },
        { text: 'Harmful subsidies eliminated (WTO)', category: 'subsidy' },
        {
          text: 'Universal adoption of science-based harvest control rules',
          category: 'monitoring',
        },
        {
          text: 'Complete global stock assessment coverage through tiered framework',
          category: 'monitoring',
        },
        { text: 'Rebuilding plans in place for all depleted stocks', category: 'recovery' },
      ]

      // Create two columns for milestones
      const milestoneGroups = [milestones.slice(0, 3), milestones.slice(3)]

      milestoneGroups.forEach((group, groupIndex) => {
        const startX = milestonesBoxX + 20 + groupIndex * 380

        group.forEach((milestone, i) => {
          const bulletY = milestonesBoxY + 50 + i * 20
          const bulletColor =
            milestone.category === 'subsidy'
              ? '#4ABDAC'
              : milestone.category === 'monitoring'
                ? '#7D8CA3'
                : '#2A3045'

          // Bullet point
          g.append('circle')
            .attr('class', 'milestone-bullet')
            .attr('cx', startX)
            .attr('cy', bulletY)
            .attr('fill', bulletColor)

          // Milestone text using foreignObject for better text handling
          const textWidth = 360
          const textHeight = 20

          const textObj = g
            .append('foreignObject')
            .attr('x', startX + 10)
            .attr('y', bulletY - 8)
            .attr('width', textWidth)
            .attr('height', textHeight)

          const textDiv = textObj
            .append('xhtml:div')
            .style('font-size', '10px')
            .style('font-family', "'Arial', sans-serif")
            .style('width', '100%')
            .style('height', '100%')

          // Handle key numbers with special formatting
          let formattedText = milestone.text
          if (formattedText.includes('100%')) {
            formattedText = formattedText.replace(
              '100%',
              "<span style='font-family: Georgia, serif; font-size: 11px; font-weight: bold; color: #2A3045;'>100%</span>"
            )
          }
          if (formattedText.includes('all')) {
            formattedText = formattedText.replace(
              'all',
              "<span style='font-family: Georgia, serif; font-size: 11px; font-weight: bold; color: #2A3045;'>all</span>"
            )
          }

          textDiv.html(formattedText)
        })
      })

      // Source attribution
      svg
        .append('text')
        .attr('class', 'source-text')
        .attr('x', width / 2 + margin.left)
        .attr('y', height + margin.top + 30)
        .text('Source: Compiled from FAO, WTO, UN SDG, and related official documents')
    </script>
  </body>
</html>
