<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industry Disparities in Telecommuting Adoption</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f9f9f9;
        }
        
        .visualization-container {
            width: 850px;
            height: 550px;
            background-color: white;
            padding: 20px;
        }
        
        .title {
            font-size: 18pt;
            font-weight: bold;
            color: #002D5A;
            margin-bottom: 5px;
            text-align: center;
        }
        
        .subtitle {
            font-size: 14pt;
            color: #4A4A4A;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .source {
            font-size: 9pt;
            font-style: italic;
            color: #777;
            text-align: left;
            margin-top: 10px;
        }
        
        .axis-label {
            font-size: 10pt;
            fill: #4A4A4A;
        }
        
        .industry-label {
            font-size: 12pt;
            fill: #4A4A4A;
            text-anchor: end;
        }
        
        .percentage-label {
            font-size: 12pt;
            font-weight: bold;
            fill: #000;
        }
        
        .highlight {
            font-family: 'Georgia', serif;
            font-size: 14pt;
            fill: #002D5A;
        }
    </style>
</head>
<body>
    <div class="visualization-container">
        <div class="title">Industry Disparities in Telecommuting Adoption</div>
        <div class="subtitle">Percentage of workforce telecommuting half-time or more by industry (Pre-pandemic, 2016)</div>
        <div id="chart"></div>
        <div class="source">Source: Global Workplace Analytics analysis of American Community Survey data (2016)</div>
    </div>

    <script>
        // Data
        const data = [
            { industry: "Professional & business services", percentage: 10.0 },
            { industry: "Management & technical consulting", percentage: 9.6 },
            { industry: "Finance & insurance", percentage: 7.4 },
            { industry: "Information services", percentage: 7.2 },
            { industry: "Education services", percentage: 3.6 },
            { industry: "Retail", percentage: 1.4 },
            { industry: "Agriculture/forestry", percentage: 0.4 }
        ];

        // Sort data in descending order
        data.sort((a, b) => b.percentage - a.percentage);

        // Set up dimensions and margins
        const margin = { top: 20, right: 40, bottom: 40, left: 300 };
        const width = 850 - margin.left - margin.right;
        const height = 420 - margin.top - margin.bottom;

        // Create SVG
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Set up scales - adjusted to use more horizontal space
        const x = d3.scaleLinear()
            .domain([0, 12])
            .range([0, width]);

        const y = d3.scaleBand()
            .domain(data.map(d => d.industry))
            .range([0, height])
            .padding(0.3);

        // Color scale for gradient
        const colorScale = d3.scaleLinear()
            .domain([0, d3.max(data, d => d.percentage)])
            .range(["#8CCDC3", "#1F9D8A"]);

        // Add x-axis - fixed alignment with start of bars
        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x)
                .tickFormat(d => d + "%")
                .tickValues([0, 2, 4, 6, 8, 10, 12]))
            .selectAll("text")
            .attr("class", "axis-label");

        // Add y-axis (industry names)
        svg.append("g")
            .call(d3.axisLeft(y).tickSize(0))
            .selectAll("text")
            .attr("class", "industry-label")
            .attr("dx", -15);

        // Remove y-axis line
        svg.select(".domain").remove();

        // Add horizontal grid lines
        svg.append("g")
            .attr("class", "grid")
            .selectAll("line")
            .data(data)
            .enter()
            .append("line")
            .attr("x1", 0)
            .attr("x2", width)
            .attr("y1", d => y(d.industry) + y.bandwidth() / 2)
            .attr("y2", d => y(d.industry) + y.bandwidth() / 2)
            .attr("stroke", "#e0e0e0")
            .attr("stroke-width", 1);

        // Add vertical grid lines
        for (let i = 2; i <= 12; i += 2) {
            svg.append("line")
                .attr("x1", x(i))
                .attr("x2", x(i))
                .attr("y1", 0)
                .attr("y2", height)
                .attr("stroke", "#e0e0e0")
                .attr("stroke-width", 1);
        }

        // Add shadow filter for bars
        svg.append("defs")
            .append("filter")
            .attr("id", "drop-shadow")
            .append("feDropShadow")
            .attr("dx", 0)
            .attr("dy", 2)
            .attr("stdDeviation", 2)
            .attr("flood-opacity", 0.2);

        // Add bars with shadow effect
        svg.selectAll(".bar")
            .data(data)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("y", d => y(d.industry))
            .attr("height", y.bandwidth())
            .attr("x", 0)
            .attr("width", d => x(d.percentage))
            .attr("fill", d => colorScale(d.percentage))
            .attr("rx", 2)
            .attr("ry", 2)
            .attr("filter", "url(#drop-shadow)"); // Added shadow effect

        // Add percentage labels with consistent styling and alignment
        svg.selectAll(".percentage-label")
            .data(data)
            .enter()
            .append("text")
            .attr("class", d => {
                // Clear visual differentiation between value ranges
                if (d.percentage >= 9.0) return "percentage-label highlight";
                else if (d.percentage >= 7.0) return "percentage-label highlight";
                return "percentage-label";
            })
            .attr("x", d => x(d.percentage) + 10)
            .attr("y", d => y(d.industry) + y.bandwidth() / 2)
            .attr("dy", "0.35em")
            .attr("dominant-baseline", "middle") // Ensures consistent vertical alignment
            .text(d => {
                // Format percentages consistently
                return d.percentage.toFixed(1) + "%";
            });
    </script>
</body>
</html>