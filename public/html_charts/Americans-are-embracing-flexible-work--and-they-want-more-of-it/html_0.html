<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Work Trends Visualization</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .visualization-container {
            width: 800px;
            height: 550px;
            position: relative;
        }
        
        .title {
            font-size: 16pt;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 12pt;
            text-align: center;
            margin-bottom: 20px;
            color: #555;
        }
        
        .axis-label {
            font-size: 12pt;
            fill: #333;
        }
        
        .tick text {
            font-size: 10pt;
            fill: #555;
        }
        
        .grid line {
            stroke: #e0e0e0;
            stroke-width: 1px;
        }
        
        .data-line {
            fill: none;
            stroke: #003366;
            stroke-width: 2px;
        }
        
        .data-point {
            fill: white;
            stroke: #003366;
            stroke-width: 2px;
        }
        
        .pandemic-period {
            fill: #e6e6e6;
            opacity: 0.9;
        }
        
        .pandemic-label {
            font-size: 10pt;
            fill: #666;
            text-anchor: middle;
        }
        
        .annotation-box {
            fill: #f8f8f8;
            stroke: #003366;
            stroke-width: 1px;
            rx: 4;
            ry: 4;
        }
        
        .annotation-text {
            font-size: 11pt;
            fill: #333;
        }
        
        .key-number {
            font-family: 'Georgia', serif;
            font-size: 13pt;
            font-weight: bold;
            fill: #003366;
        }
        
        .source-note {
            font-size: 10pt;
            fill: #999;
            text-anchor: end;
        }
        
        .legend {
            font-size: 11pt;
            fill: #555;
        }
        
        .legend-box {
            fill: white;
            stroke: #e0e0e0;
            stroke-width: 1px;
            rx: 4;
            ry: 4;
        }
    </style>
</head>
<body>
    <div class="visualization-container">
        <div class="title">The Dramatic Rise of Remote Work in the United States (1990-2023)</div>
        <div class="subtitle">Percentage of paid workdays performed from home</div>
        <svg id="chart"></svg>
    </div>

    <script>
        // Set up dimensions
        const margin = {top: 40, right: 50, bottom: 70, left: 60};
        const width = 800 - margin.left - margin.right;
        const height = 450 - margin.top - margin.bottom;
        
        // Create SVG
        const svg = d3.select("#chart")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);
        
        // Data points
        const data = [
            {year: 1990, percentage: 2.8},
            {year: 2000, percentage: 3.5},  // Interpolated value
            {year: 2010, percentage: 5.0},  // Interpolated value
            {year: 2019, percentage: 7.0},
            {year: 2020, percentage: 25.0}, // Estimated peak during pandemic
            {year: 2021, percentage: 30.0}, // Estimated value
            {year: 2022, percentage: 29.0}, // Estimated value
            {year: 2023, percentage: 28.0}
        ];
        
        // Key data points to mark with circles
        const keyPoints = [1990, 2019, 2020, 2023];
        
        // Set up scales
        const xScale = d3.scaleLinear()
            .domain([1990, 2023])
            .range([0, width]);
        
        const yScale = d3.scaleLinear()
            .domain([0, 35])
            .range([height, 0]);
        
        // Add pandemic period highlight - increased opacity
        svg.append("rect")
            .attr("class", "pandemic-period")
            .attr("x", xScale(2020) - 5)
            .attr("y", 0)
            .attr("width", xScale(2022) - xScale(2020) + 10)
            .attr("height", height);
        
        // Add gridlines
        svg.append("g")
            .attr("class", "grid")
            .selectAll("line")
            .data(d3.range(0, 36, 5))
            .enter()
            .append("line")
            .attr("x1", 0)
            .attr("x2", width)
            .attr("y1", d => yScale(d))
            .attr("y2", d => yScale(d));
        
        // Add x-axis with consistent labels
        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(xScale)
                .tickValues([1990, 1995, 2000, 2005, 2010, 2015, 2020])
                .tickFormat(d3.format("d")));
        
        // Add y-axis
        svg.append("g")
            .call(d3.axisLeft(yScale)
                .tickValues(d3.range(0, 36, 5))
                .tickFormat(d => d + "%"));
        
        // Add y-axis label
        svg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("y", -margin.left + 20)
            .attr("x", -height / 2)
            .attr("text-anchor", "middle")
            .text("Percentage of workdays");
        
        // Create line generator
        const line = d3.line()
            .x(d => xScale(d.year))
            .y(d => yScale(d.percentage))
            .curve(d3.curveMonotoneX);
        
        // Add the line
        svg.append("path")
            .datum(data)
            .attr("class", "data-line")
            .attr("d", line);
        
        // Add data points for key points
        svg.selectAll(".data-point")
            .data(data.filter(d => keyPoints.includes(d.year)))
            .enter()
            .append("circle")
            .attr("class", "data-point")
            .attr("cx", d => xScale(d.year))
            .attr("cy", d => yScale(d.percentage))
            .attr("r", 6);
        
        // Add data labels for key points only - fixed positioning for 1990 point
        svg.selectAll(".data-label")
            .data(data.filter(d => keyPoints.includes(d.year)))
            .enter()
            .append("text")
            .attr("x", d => xScale(d.year))
            .attr("y", d => yScale(d.percentage) - 15)
            .attr("text-anchor", "middle")
            .attr("class", "key-number")
            .text(d => d.percentage + "%");
        
        // Add pandemic label at the bottom of the chart
        svg.append("text")
            .attr("class", "pandemic-label")
            .attr("x", xScale(2020))
            .attr("y", height + 30)
            .text("COVID-19 Pandemic");
        
        // Add annotation for COVID impact - wider box and better positioning
        const annotationX = xScale(2018);
        const annotationY = yScale(20);
        
        // Annotation box - wider to fit text
        svg.append("rect")
            .attr("class", "annotation-box")
            .attr("x", annotationX - 120)
            .attr("y", annotationY)
            .attr("width", 240)
            .attr("height", 30)
            .attr("rx", 4)
            .attr("ry", 4);
        
        // Draw arrow with better positioning
        svg.append("path")
            .attr("d", `M${annotationX + 60},${annotationY + 15} L${xScale(2020) - 10},${yScale(25) + 5}`)
            .attr("stroke", "#003366")
            .attr("stroke-width", 1.5)
            .attr("fill", "none")
            .attr("marker-end", "url(#arrow)");
            
        // Define arrow marker
        svg.append("defs").append("marker")
            .attr("id", "arrow")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 8)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#003366");
        
        // Annotation text - fixed to prevent truncation
        svg.append("text")
            .attr("class", "annotation-text")
            .attr("x", annotationX)
            .attr("y", annotationY + 20)
            .attr("text-anchor", "middle")
            .html("COVID-19: <tspan class='key-number'>4Ã—</tspan> increase in remote work");
        
        // Add legend with proper styling
        const legendX = 20;
        const legendY = 25;
        
        // Legend background
        svg.append("rect")
            .attr("class", "legend-box")
            .attr("x", legendX - 10)
            .attr("y", legendY - 15)
            .attr("width", 180)
            .attr("height", 30)
            .attr("rx", 4)
            .attr("ry", 4);
        
        // Legend line
        svg.append("line")
            .attr("x1", legendX)
            .attr("x2", legendX + 30)
            .attr("y1", legendY)
            .attr("y2", legendY)
            .attr("stroke", "#003366")
            .attr("stroke-width", 2);
        
        // Legend point
        svg.append("circle")
            .attr("cx", legendX + 15)
            .attr("cy", legendY)
            .attr("r", 5)
            .attr("fill", "white")
            .attr("stroke", "#003366")
            .attr("stroke-width", 2);
        
        // Legend text
        svg.append("text")
            .attr("class", "legend")
            .attr("x", legendX + 40)
            .attr("y", legendY + 4)
            .text("Remote work adoption");
        
        // Add source note
        svg.append("text")
            .attr("class", "source-note")
            .attr("x", width)
            .attr("y", height + 50)
            .text("Source: WFH Research Survey of Working Arrangements and Attitudes (SWAA), mid-2023");
    </script>
</body>
</html>