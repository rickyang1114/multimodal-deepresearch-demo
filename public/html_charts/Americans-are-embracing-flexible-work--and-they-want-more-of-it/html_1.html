<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Arrangement Preferences vs Requirements</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .visualization-container {
            width: 800px;
            height: 500px;
            background-color: white;
            position: relative;
        }
        
        .title {
            font-size: 18pt;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 14pt;
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        
        .source {
            font-size: 10pt;
            color: #999;
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .axis-label {
            font-size: 14pt;
            font-weight: bold;
        }
        
        .segment-label {
            fill: white;
            font-size: 14pt;
            text-anchor: middle;
            dominant-baseline: middle;
        }
        
        .key-number {
            font-family: 'Georgia', serif;
            font-size: 16pt;
            font-weight: bold;
        }
        
        .legend-item {
            font-size: 12pt;
        }
        
        .gridline {
            stroke: #f0f0f0;
            stroke-width: 1px;
        }
        
        .bar {
            stroke: #e0e0e0;
            stroke-width: 1px;
        }
    </style>
</head>
<body>
    <div class="visualization-container">
        <div class="title">The Disconnect Between Employee Preferences and Company Policies (2023)</div>
        <div class="subtitle">Percentage of employees preferring each work arrangement versus percentage of companies requiring them</div>
        <svg id="chart"></svg>
        <div class="source">Source: Owl Labs' State of Hybrid Work survey, 2023</div>
    </div>

    <script>
        // Set up dimensions
        const width = 800;
        const height = 350;
        const margin = { top: 30, right: 40, bottom: 60, left: 250 }; // Increased left margin from 220px to 250px
        const innerWidth = width - margin.left - margin.right;
        const innerHeight = height - margin.top - margin.bottom;
        
        // Data
        const data = [
            {
                category: "Employee Preferences",
                values: [
                    { arrangement: "Fully Remote", percentage: 37 },
                    { arrangement: "Hybrid", percentage: 41 },
                    { arrangement: "Fully In-Office", percentage: 22 }
                ]
            },
            {
                category: "Company Requirements",
                values: [
                    { arrangement: "Fully Remote", percentage: 11 },
                    { arrangement: "Hybrid", percentage: 23 },
                    { arrangement: "Fully In-Office", percentage: 66 }
                ]
            }
        ];
        
        // Color scale
        const colorScale = d3.scaleOrdinal()
            .domain(["Fully Remote", "Hybrid", "Fully In-Office"])
            .range(["#00A0A0", "#0047AB", "#708090"]); // Brighter teal, royal blue, slate gray
        
        // Create SVG
        const svg = d3.select("#chart")
            .attr("width", width)
            .attr("height", height);
        
        // Create chart group
        const chart = svg.append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`);
        
        // Create scales
        const xScale = d3.scaleLinear()
            .domain([0, 100])
            .range([0, innerWidth]);
        
        const yScale = d3.scaleBand()
            .domain(data.map(d => d.category))
            .range([0, innerHeight])
            .padding(0.4);
        
        // Add gridlines
        for (let i = 0; i <= 100; i += 20) {
            chart.append("line")
                .attr("class", "gridline")
                .attr("x1", xScale(i))
                .attr("y1", -10)
                .attr("x2", xScale(i))
                .attr("y2", innerHeight)
                .attr("stroke-dasharray", i === 0 ? "none" : "3,3");
        }
        
        // Add x-axis ticks and labels
        chart.selectAll(".tick-label")
            .data([0, 20, 40, 60, 80, 100])
            .enter()
            .append("text")
            .attr("class", "tick-label")
            .attr("x", d => xScale(d))
            .attr("y", innerHeight + 20)
            .attr("text-anchor", "middle")
            .text(d => d + "%")
            .style("font-size", "12px")
            .style("fill", "#666");
        
        // Add y-axis labels
        chart.selectAll(".axis-label")
            .data(data)
            .enter()
            .append("text")
            .attr("class", "axis-label")
            .attr("x", -10)
            .attr("y", d => yScale(d.category) + yScale.bandwidth() / 2)
            .attr("text-anchor", "end")
            .attr("dominant-baseline", "middle")
            .text(d => d.category);
        
        // Create stacked data
        data.forEach(category => {
            let cumulative = 0;
            category.values.forEach(item => {
                item.start = cumulative;
                cumulative += item.percentage;
                item.end = cumulative;
            });
        });
        
        // Draw bars
        const barGroups = chart.selectAll(".bar-group")
            .data(data)
            .enter()
            .append("g")
            .attr("class", "bar-group")
            .attr("transform", d => `translate(0, ${yScale(d.category)})`);
        
        // Draw bar segments
        barGroups.each(function(d) {
            const group = d3.select(this);
            
            d.values.forEach(item => {
                const segmentWidth = xScale(item.percentage);
                const startX = xScale(item.start);
                
                group.append("rect")
                    .attr("class", "bar")
                    .attr("x", startX)
                    .attr("y", 0)
                    .attr("width", segmentWidth)
                    .attr("height", yScale.bandwidth())
                    .attr("fill", colorScale(item.arrangement));
                
                // Add percentage labels inside segments
                if (item.percentage >= 10) {  // Only add text if there's enough space
                    group.append("text")
                        .attr("class", "segment-label")
                        .attr("x", startX + segmentWidth / 2)
                        .attr("y", yScale.bandwidth() / 2)
                        .text(item.percentage + "%")
                        .classed("key-number", item.percentage > 30);  // Highlight significant numbers
                }
            });
        });
        
        // Add legend
        const legend = svg.append("g")
            .attr("transform", `translate(${width - margin.right - 150}, ${margin.top - 10})`);
        
        const legendItems = ["Fully Remote", "Hybrid", "Fully In-Office"];
        
        legendItems.forEach((item, i) => {
            const legendGroup = legend.append("g")
                .attr("transform", `translate(0, ${i * 20})`);
            
            legendGroup.append("rect")
                .attr("width", 12)
                .attr("height", 12)
                .attr("fill", colorScale(item));
            
            legendGroup.append("text")
                .attr("class", "legend-item")
                .attr("x", 20)
                .attr("y", 10)
                .text(item);
        });
    </script>
</body>
</html>