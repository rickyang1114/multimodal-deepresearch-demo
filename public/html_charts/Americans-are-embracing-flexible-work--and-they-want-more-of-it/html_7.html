<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Rise of Polyworking in the U.S. Workforce (2023)</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 20px;
        }
        
        .visualization-container {
            width: 900px;
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .title {
            font-size: 22pt;
            font-weight: bold;
            text-align: center;
            margin: 15px 0 25px 0;
            width: 100%;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 20px;
            width: 100%;
        }
        
        .chart-container {
            position: relative;
            border: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background-color: white;
            height: 350px;
        }
        
        .donut-center {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 140px;
            height: 140px;
            text-align: center;
            pointer-events: none;
        }
        
        .donut-title {
            font-size: 14pt;
            font-weight: bold;
            line-height: 1.3;
            text-align: center;
        }
        
        .percentage {
            font-family: 'Georgia', serif;
            font-weight: bold;
            font-size: 16pt;
        }
        
        .explanatory-note {
            background-color: #f8f8f8;
            padding: 15px;
            margin: 20px 0 10px 0;
            font-size: 12pt;
            line-height: 1.4;
            border-radius: 5px;
            width: calc(100% - 30px);
            box-sizing: border-box;
        }
        
        .source {
            font-size: 10pt;
            color: #888;
            text-align: right;
            width: 100%;
            margin-top: 10px;
            padding-right: 15px;
            box-sizing: border-box;
        }
        
        .tooltip {
            position: absolute;
            padding: 8px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 4px;
            pointer-events: none;
            font-size: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .segment-label {
            font-size: 11pt;
            fill: #333;
        }
        
        .legend {
            display: flex;
            flex-direction: column;
            position: absolute;
            font-size: 11px;
            right: 10px;
            top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            margin-right: 5px;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="visualization-container">
        <h1 class="title">The Rise of Polyworking in the U.S. Workforce (2023)</h1>
        
        <div class="charts-grid">
            <div class="chart-container" id="chart1"></div>
            <div class="chart-container" id="chart2"></div>
            <div class="chart-container" id="chart3"></div>
            <div class="chart-container" id="chart4"></div>
        </div>
        
        <div class="explanatory-note">
            Polyworking—holding multiple jobs or side hustles—is most common among full-time in-office employees and Millennials, suggesting that financial needs and schedule flexibility are driving this trend.
        </div>
        
        <div class="source">
            Source: Owl Labs' State of Hybrid Work survey, 2023
        </div>
    </div>

    <script>
        // Create tooltip div
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
            
        // Chart dimensions
        const width = 320;
        const height = 320;
        const margin = 20;
        const radius = Math.min(width, height) / 2 - margin;
        const innerRadius = radius * 0.6; // 40% hole
        
        // Color schemes
        const colors = {
            primary: "#003366",    // Deep Navy
            secondary: "#008080",  // Teal
            tertiary: "#708090",   // Slate Gray
            quaternary: "#556B2F", // Olive Green
            quinary: "#FF6F61"     // Coral
        };
        
        // Chart 1: Overall Polyworking Status
        const data1 = [
            { label: "Currently have a side hustle", value: 46, color: colors.primary },
            { label: "Planning to start one", value: 36, color: colors.secondary },
            { label: "No side hustle/not planning", value: 18, color: colors.tertiary }
        ];
        createDonutChart("#chart1", data1, "Overall Polyworking Status");
        
        // Chart 2: Primary Work Arrangement of Polyworkers
        const data2 = [
            { label: "Full-time in-office", value: 68, color: colors.primary },
            { label: "Hybrid employees", value: 20, color: colors.secondary },
            { label: "Fully remote", value: 12, color: colors.tertiary }
        ];
        createDonutChart("#chart2", data2, "Primary Work Arrangement");
        
        // Chart 3: Age Distribution of Polyworkers
        const data3 = [
            { label: "Millennials", value: 74, color: colors.primary },
            { label: "Gen X", value: 16, color: colors.secondary },
            { label: "Gen Z", value: 7, color: colors.tertiary },
            { label: "Baby Boomers", value: 3, color: colors.quaternary }
        ];
        createDonutChart("#chart3", data3, "Age Distribution");
        
        // Chart 4: Gender Distribution of Polyworkers
        const data4 = [
            { label: "Men", value: 62, color: colors.primary },
            { label: "Women", value: 38, color: colors.quinary }
        ];
        createDonutChart("#chart4", data4, "Gender Distribution");
        
        function createDonutChart(selector, data, title) {
            const container = d3.select(selector);
            
            // Clear any existing content
            container.html("");
            
            const svg = container
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width / 2}, ${height / 2})`);
            
            // Add title in the center
            container.append("div")
                .attr("class", "donut-center")
                .style("left", `${(container.node().offsetWidth - 140) / 2}px`)
                .style("top", `${(container.node().offsetHeight - 140) / 2}px`)
                .html(`<div class="donut-title">${title}</div>`);
            
            // Pie generator
            const pie = d3.pie()
                .value(d => d.value)
                .sort(null)
                .padAngle(0.02);
            
            // Arc generator
            const arc = d3.arc()
                .innerRadius(innerRadius)
                .outerRadius(radius)
                .cornerRadius(3);
            
            // Create pie chart
            const arcs = svg.selectAll(".arc")
                .data(pie(data))
                .enter()
                .append("g")
                .attr("class", "arc");
            
            // Add segments
            arcs.append("path")
                .attr("d", arc)
                .attr("fill", d => d.data.color)
                .attr("stroke", "white")
                .attr("stroke-width", 2)
                .on("mouseover", function(event, d) {
                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr("opacity", 0.8);
                    
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", 0.9);
                    
                    tooltip.html(`${d.data.label}: <span class="percentage">${d.data.value}%</span>`)
                        .style("left", (event.pageX + 10) + "px")
                        .style("top", (event.pageY - 28) + "px");
                })
                .on("mouseout", function() {
                    d3.select(this)
                        .transition()
                        .duration(200)
                        .attr("opacity", 1);
                    
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });
            
            // Add percentage labels directly on segments
            arcs.append("text")
                .attr("transform", d => {
                    // Only position the text if the segment is large enough
                    if (d.endAngle - d.startAngle > 0.25) {
                        const centroid = arc.centroid(d);
                        return `translate(${centroid[0]}, ${centroid[1]})`;
                    } else {
                        return "translate(-1000,-1000)"; // Move off-screen if segment too small
                    }
                })
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .attr("font-size", "14pt")
                .attr("font-weight", "bold")
                .text(d => `${d.data.value}%`);
            
            // Add legend instead of external labels
            const legend = container.append("div")
                .attr("class", "legend");
                
            data.forEach((item, i) => {
                const legendItem = legend.append("div")
                    .attr("class", "legend-item");
                    
                legendItem.append("div")
                    .attr("class", "legend-color")
                    .style("background-color", item.color);
                    
                legendItem.append("div")
                    .text(`${item.label} (${item.value}%)`);
            });
        }
    </script>
</body>
</html>