<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regional EdTech Dynamics & Business Model Diversification</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            color: #333;
            display: flex;
            justify-content: center;
        }
        
        .visualization-container {
            width: 850px;
            height: 700px;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2D3E50;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 15px;
            color: #2D3E50;
        }
        
        .map-section {
            height: 380px;
            position: relative;
            margin-bottom: 30px;
        }
        
        .business-section {
            height: 220px;
            display: flex;
            margin-top: 20px;
        }
        
        .bar-chart {
            width: 60%;
        }
        
        .pie-chart {
            width: 40%;
        }
        
        .footnote {
            font-size: 12px;
            color: #777;
            margin-top: 20px;
            font-style: italic;
            text-align: center;
        }
        
        .region-bubble {
            cursor: pointer;
            stroke: white;
            stroke-width: 1.5;
        }
        
        .region-bubble:hover {
            stroke-width: 2.5;
            stroke: #ddd;
        }
        
        .region-label {
            text-anchor: middle;
            font-size: 12px;
            font-weight: bold;
            pointer-events: none;
            fill: white;
            text-shadow: 0px 0px 3px rgba(0,0,0,0.5);
        }
        
        .region-value {
            text-anchor: middle;
            font-size: 11px;
            pointer-events: none;
            fill: white;
            text-shadow: 0px 0px 3px rgba(0,0,0,0.5);
        }
        
        .region-cagr {
            text-anchor: middle;
            font-size: 11px;
            pointer-events: none;
            fill: white;
            text-shadow: 0px 0px 3px rgba(0,0,0,0.5);
        }
        
        .callout {
            position: absolute;
            background-color: rgba(240, 140, 0, 0.1);
            border: 1px solid #F08C00;
            border-radius: 5px;
            padding: 10px;
            font-size: 12px;
            max-width: 250px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .callout-title {
            font-weight: bold;
            color: #F08C00;
            margin-bottom: 5px;
        }
        
        .callout-content {
            line-height: 1.4;
        }
        
        .highlight-number {
            font-family: 'Georgia', serif;
            font-size: 14px;
            font-weight: bold;
            color: #1E8F7A;
        }
        
        .bar-label {
            font-size: 12px;
            font-weight: bold;
        }
        
        .bar-value {
            font-size: 12px;
            font-weight: bold;
        }
        
        .pie-label {
            font-size: 14px;
            font-weight: bold;
        }
        
        .connector {
            stroke: #aaa;
            stroke-width: 1.5;
            stroke-dasharray: 3,3;
        }
        
        @keyframes pulse {
            0% {
                opacity: 0.7;
                r: attr(data-radius);
            }
            50% {
                opacity: 1;
                r: calc(attr(data-radius) * 1.05);
            }
            100% {
                opacity: 0.7;
                r: attr(data-radius);
            }
        }
        
        .pulse-ring {
            fill: none;
            stroke: #1E8F7A;
            stroke-width: 2;
            opacity: 0;
            animation: pulse-ring 2s infinite;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(0.95);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.3;
            }
            100% {
                transform: scale(0.95);
                opacity: 0.7;
            }
        }
        
        .model-icon {
            font-size: 14px;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="visualization-container">
        <div class="title">Regional EdTech Dynamics & Business Model Diversification</div>
        
        <div class="section-title">Regional Market Size & Growth Rates</div>
        <div class="map-section" id="map-section"></div>
        
        <div class="section-title">Business Model Distribution & Revenue Sources</div>
        <div class="business-section">
            <div class="bar-chart" id="bar-chart"></div>
            <div class="pie-chart" id="pie-chart"></div>
        </div>
        
        <div class="footnote">Sources: Grand View Research, Arizton, APAC EdTech Market Focused Insights (2022-2024)</div>
    </div>

    <script>
        // Data for the visualization
        const regionData = [
            { 
                name: "North America", 
                value: 150, 
                cagr: 12.5, 
                x: 250, 
                y: 150, 
                description: "Leading market position",
                color: "#3D5A80"
            },
            { 
                name: "Asia-Pacific", 
                value: 129.66, 
                cagr: 16.17, 
                x: 520, 
                y: 180, 
                description: "$129.66B (2022), 16.17% CAGR to 2028",
                color: "#1E8F7A",
                highlight: true
            },
            { 
                name: "Europe", 
                value: 90, 
                cagr: 11.2, 
                x: 400, 
                y: 130, 
                description: "Steady growth",
                color: "#4D7EA8"
            },
            { 
                name: "Rest of World", 
                value: 45, 
                cagr: 14.8, 
                x: 350, 
                y: 250, 
                description: "Emerging markets",
                color: "#6B9AC4"
            }
        ];

        const businessModelData = [
            { model: "Freemium", percentage: 35, icon: "gift" },
            { model: "Subscription", percentage: 42, icon: "sync" },
            { model: "Marketplace", percentage: 15, icon: "store" },
            { model: "Institutional Sales", percentage: 25, icon: "building" }
        ];

        const revenueData = [
            { type: "B2B", percentage: 66, color: "#3D5A80" },
            { type: "B2C", percentage: 34, color: "#1E8F7A" }
        ];

        const indiaCallout = {
            title: "India EdTech Spotlight",
            content: "Government initiatives: PM e-VIDYA/DIKSHA offering free 30-day, 6 hr/day NEET & CUET coaching to 163,000 students; Leading startups: BYJU'S, Unacademy, Physics Wallah"
        };

        // Create the map visualization with a more recognizable world map
        function createMap() {
            const width = 800;
            const height = 380;
            
            const svg = d3.select("#map-section")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            // Create a more recognizable world map outline
            const worldMapPath = "M100,120 C120,100 150,90 180,100 C210,110 240,100 270,110 C300,120 330,110 360,120 C390,130 420,120 450,130 C480,140 510,130 540,140 C570,150 600,140 630,150 L630,250 C600,240 570,250 540,240 C510,230 480,240 450,230 C420,220 390,230 360,220 C330,210 300,220 270,210 C240,200 210,210 180,200 C150,190 120,200 100,190 Z";
            
            svg.append("path")
                .attr("d", worldMapPath)
                .style("fill", "#f0f0f0")
                .style("stroke", "#ddd")
                .style("stroke-width", 1);
            
            // Add continent-like shapes for better geographic context
            const continents = [
                {path: "M150,130 Q200,120 250,130 T350,140 L350,200 Q300,210 250,200 T150,190 Z", fill: "#e8e8e8", name: "North America"},
                {path: "M400,130 Q450,120 500,130 T600,140 L600,200 Q550,210 500,200 T400,190 Z", fill: "#e8e8e8", name: "Eurasia"},
                {path: "M350,180 Q400,170 450,180 T550,190 L550,240 Q500,250 450,240 T350,230 Z", fill: "#e6e6e6", name: "Africa/Middle East"},
                {path: "M550,150 Q600,140 650,150 T700,160 L700,210 Q650,220 600,210 T550,200 Z", fill: "#e8e8e8", name: "Asia/Pacific"}
            ];
            
            svg.selectAll(".continent")
                .data(continents)
                .enter()
                .append("path")
                .attr("d", d => d.path)
                .style("fill", d => d.fill)
                .style("stroke", "#ddd")
                .style("stroke-width", 0.5);
            
            // Add subtle continent labels for context
            svg.selectAll(".continent-label")
                .data(continents)
                .enter()
                .append("text")
                .attr("class", "continent-label")
                .attr("x", d => {
                    if (d.name === "North America") return 200;
                    if (d.name === "Eurasia") return 500;
                    if (d.name === "Africa/Middle East") return 450;
                    if (d.name === "Asia/Pacific") return 625;
                })
                .attr("y", d => {
                    if (d.name === "North America") return 160;
                    if (d.name === "Eurasia") return 160;
                    if (d.name === "Africa/Middle East") return 210;
                    if (d.name === "Asia/Pacific") return 180;
                })
                .text(d => d.name)
                .style("fill", "#ccc")
                .style("font-size", "10px")
                .style("text-anchor", "middle");
            
            // Add pulse effect for Asia-Pacific
            const pulseGroup = svg.append("g");
            
            regionData.forEach(region => {
                if (region.highlight) {
                    pulseGroup.append("circle")
                        .attr("cx", region.x)
                        .attr("cy", region.y)
                        .attr("r", Math.sqrt(region.value) * 1.5 + 5)
                        .attr("class", "pulse-ring")
                        .style("stroke", region.color);
                }
            });
            
            // Add bubbles for regions with improved positioning
            const bubbleGroup = svg.append("g");
            
            bubbleGroup.selectAll(".region-bubble")
                .data(regionData)
                .enter()
                .append("circle")
                .attr("class", "region-bubble")
                .attr("cx", d => d.x)
                .attr("cy", d => d.y)
                .attr("r", d => Math.sqrt(d.value) * 1.5)
                .style("fill", d => d.color)
                .style("fill-opacity", 0.8);
            
            // Add region names with improved positioning
            bubbleGroup.selectAll(".region-label")
                .data(regionData)
                .enter()
                .append("text")
                .attr("class", "region-label")
                .attr("x", d => d.x)
                .attr("y", d => d.y - 10)
                .text(d => d.name);
            
            // Add region values with improved positioning
            bubbleGroup.selectAll(".region-value")
                .data(regionData)
                .enter()
                .append("text")
                .attr("class", "region-value")
                .attr("x", d => d.x)
                .attr("y", d => d.y + 5)
                .text(d => `$${d.value}B`);
            
            // Add CAGR values with arrow icon and improved positioning
            bubbleGroup.selectAll(".region-cagr")
                .data(regionData)
                .enter()
                .append("text")
                .attr("class", "region-cagr")
                .attr("x", d => d.x)
                .attr("y", d => d.y + 20)
                .text(d => `↑ ${d.cagr}% CAGR`);
            
            // Add callout for Asia-Pacific/India with improved positioning
            const callout = d3.select("#map-section")
                .append("div")
                .attr("class", "callout")
                .style("left", "600px")
                .style("top", "130px");
            
            callout.append("div")
                .attr("class", "callout-title")
                .text(indiaCallout.title);
            
            callout.append("div")
                .attr("class", "callout-content")
                .text(indiaCallout.content);
            
            // Add a connector line from Asia-Pacific bubble to callout with improved positioning
            svg.append("line")
                .attr("x1", 580)
                .attr("y1", 150)
                .attr("x2", 520)
                .attr("y2", 180)
                .style("stroke", "#F08C00")
                .style("stroke-width", 1.5);
        }

        // Create the business model bar chart with SVG icons
        function createBarChart() {
            const width = 480;
            const height = 200;
            const margin = { top: 20, right: 50, bottom: 30, left: 150 };
            
            const svg = d3.select("#bar-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height);
            
            const x = d3.scaleLinear()
                .domain([0, 50])
                .range([margin.left, width - margin.right]);
            
            const y = d3.scaleBand()
                .domain(businessModelData.map(d => d.model))
                .range([margin.top, height - margin.bottom])
                .padding(0.3);
            
            // Add x-axis
            svg.append("g")
                .attr("transform", `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x).ticks(5).tickFormat(d => d + "%"))
                .call(g => g.select(".domain").remove());
            
            // Add y-axis with no domain line
            svg.append("g")
                .attr("transform", `translate(${margin.left},0)`)
                .call(d3.axisLeft(y).tickSize(0))
                .call(g => g.select(".domain").remove());
            
            // Add bars
            const colorScale = d3.scaleOrdinal()
                .domain(businessModelData.map(d => d.model))
                .range(["#3D5A80", "#4D7EA8", "#6B9AC4", "#98C1D9"]);
            
            const bars = svg.selectAll(".bar")
                .data(businessModelData)
                .enter()
                .append("rect")
                .attr("class", "bar")
                .attr("x", margin.left)
                .attr("y", d => y(d.model))
                .attr("width", d => x(d.percentage) - margin.left)
                .attr("height", y.bandwidth())
                .attr("fill", d => colorScale(d.model));
            
            // Add custom SVG icons instead of FontAwesome
            const iconPaths = {
                "gift": "M3,5 v2 h10 v-2 z M4,7 v6 h3 v-6 z M9,7 v6 h3 v-6 z M5,3 l2,2 l2,-2 z",
                "sync": "M13,8 a5,5 0 1,1 -2,-4 l-2,2 h5 v-5 l-2,2 a7,7 0 1,0 2,5 z",
                "store": "M2,3 h12 v3 h-12 z M3,6 v7 h10 v-7 M3,9 h10 M7,6 v7",
                "building": "M3,14 h10 v-10 h-10 z M6,14 v-3 h4 v3 M5,7 h2 v2 h-2 z M9,7 h2 v2 h-2 z M5,10 h2 v2 h-2 z M9,10 h2 v2 h-2 z"
            };
            
            // Add icon backgrounds
            svg.selectAll(".icon-bg")
                .data(businessModelData)
                .enter()
                .append("circle")
                .attr("class", "icon-bg")
                .attr("cx", margin.left - 25)
                .attr("cy", d => y(d.model) + y.bandwidth() / 2)
                .attr("r", 10)
                .style("fill", d => colorScale(d.model))
                .style("opacity", 0.2);
            
            // Add SVG icons
            svg.selectAll(".model-icon")
                .data(businessModelData)
                .enter()
                .append("g")
                .attr("class", "model-icon")
                .attr("transform", d => `translate(${margin.left - 25}, ${y(d.model) + y.bandwidth() / 2})`)
                .append("path")
                .attr("d", d => iconPaths[d.icon])
                .attr("transform", "translate(-8, -8) scale(1)")
                .style("fill", d => colorScale(d.model));
            
            // Add percentage values
            svg.selectAll(".bar-value")
                .data(businessModelData)
                .enter()
                .append("text")
                .attr("class", "bar-value")
                .attr("x", d => x(d.percentage) + 5)
                .attr("y", d => y(d.model) + y.bandwidth() / 2 + 5)
                .text(d => d.percentage + "%")
                .style("fill", "#333")
                .style("font-weight", "bold");
        }

        // Create the revenue pie chart with improved labels
        function createPieChart() {
            const width = 220;
            const height = 200;
            const radius = Math.min(width, height) / 2 - 10;
            
            const svg = d3.select("#pie-chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${width / 2},${height / 2})`);
            
            const pie = d3.pie()
                .value(d => d.percentage)
                .sort(null);
            
            const arc = d3.arc()
                .innerRadius(0)
                .outerRadius(radius - 20);
            
            // Add pie segments
            const path = svg.selectAll(".arc")
                .data(pie(revenueData))
                .enter()
                .append("path")
                .attr("class", "arc")
                .attr("d", arc)
                .attr("fill", d => d.data.color);
            
            // Add percentage labels
            svg.selectAll(".pie-label")
                .data(pie(revenueData))
                .enter()
                .append("text")
                .attr("class", "pie-label")
                .attr("transform", d => {
                    const pos = arc.centroid(d);
                    return `translate(${pos[0]},${pos[1]})`;
                })
                .attr("dy", "0.35em")
                .style("text-anchor", "middle")
                .style("fill", "white")
                .style("font-weight", "bold")
                .style("font-size", "16px")
                .text(d => d.data.percentage + "%");
            
            // Add type labels with improved positioning
            svg.selectAll(".pie-type")
                .data(pie(revenueData))
                .enter()
                .append("text")
                .attr("class", "pie-type")
                .attr("transform", d => {
                    // Position B2B at the bottom right of the pie
                    if (d.data.type === "B2B") {
                        return "translate(40, 70)";
                    }
                    // Position B2C at the top left of the pie
                    return "translate(-40, -70)";
                })
                .style("text-anchor", "middle")
                .style("fill", d => d.data.color)
                .style("font-weight", "bold")
                .style("font-size", "16px")
                .text(d => d.data.type);
            
            // Add title
            svg.append("text")
                .attr("x", 0)
                .attr("y", -radius - 10)
                .attr("text-anchor", "middle")
                .style("font-size", "14px")
                .style("font-weight", "bold")
                .text("Global Revenue Split");
            
            // Add visible connector from bar chart to pie chart
            d3.select("#bar-chart svg")
                .append("path")
                .attr("class", "connector")
                .attr("d", "M480,100 C500,100 510,100 530,100")
                .style("fill", "none")
                .style("stroke", "#aaa")
                .style("stroke-width", 1.5)
                .style("stroke-dasharray", "5,3")
                .style("opacity", 1);
        }

        // Initialize the visualization
        document.addEventListener("DOMContentLoaded", function() {
            createMap();
            createBarChart();
            createPieChart();
        });
    </script>
</body>
</html>