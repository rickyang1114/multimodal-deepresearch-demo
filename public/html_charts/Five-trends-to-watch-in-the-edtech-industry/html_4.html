<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdTech Policy, Equity & Infrastructure: State-Level Trends</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .dashboard-container {
            width: 900px;
            height: 650px;
            background-color: #ffffff;
            padding: 15px;
            box-sizing: border-box;
        }
        
        .dashboard-title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        
        .panels-container {
            display: flex;
            justify-content: space-between;
            height: 540px;
        }
        
        .panel {
            width: 32%;
            background-color: #f9f9f9;
            border-radius: 5px;
            padding: 15px;
            box-sizing: border-box;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .panel-title {
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
        }
        
        .panel-title i {
            margin-right: 8px;
            color: #555;
        }
        
        .chart-container {
            flex-grow: 1;
            position: relative;
        }
        
        .key-number {
            font-family: 'Georgia', serif;
            font-size: 16px;
            font-weight: bold;
        }
        
        .callout {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 10px;
            position: absolute;
            max-width: 130px;
            z-index: 10;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .callout.positive {
            border-left: 3px solid #1E8F7A;
        }
        
        .callout.negative {
            border-left: 3px solid #D64541;
        }
        
        .callout i {
            margin-right: 5px;
        }
        
        .sources {
            font-size: 9px;
            color: #777;
            text-align: center;
            margin-top: 15px;
            font-style: italic;
        }
        
        .axis text {
            font-size: 9px;
            fill: #555;
        }
        
        .axis line, .axis path {
            stroke: #ddd;
        }
        
        .grid line {
            stroke: #eee;
            stroke-opacity: 0.7;
        }
        
        .tooltip {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 8px;
            font-size: 11px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        
        .chart-subtitle {
            font-size: 10px;
            text-align: center;
            color: #666;
            margin-top: 5px;
            padding-top: 5px;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            margin-top: 5px;
            margin-bottom: 10px;
            width: 100%;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 8px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 3px 8px;
            border-radius: 3px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            margin-right: 6px;
            border-radius: 2px;
        }
        
        .axis-label {
            font-size: 10px;
            fill: #666;
            text-anchor: middle;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-title">EdTech Policy, Equity & Infrastructure: State-Level Trends</div>
        
        <div class="panels-container">
            <div class="panel" id="ai-policy-panel">
                <div class="panel-title">
                    <i class="fas fa-file-alt"></i> AI Policy Adoption in K-12 Education
                </div>
                <div class="chart-container" id="ai-policy-chart"></div>
            </div>
            
            <div class="panel" id="digital-equity-panel">
                <div class="panel-title">
                    <i class="fas fa-network-wired"></i> Digital Equity & Professional Development
                </div>
                <div class="legend" id="equity-legend"></div>
                <div class="chart-container" id="digital-equity-chart"></div>
            </div>
            
            <div class="panel" id="funding-panel">
                <div class="panel-title">
                    <i class="fas fa-dollar-sign"></i> Funding Sufficiency Perceptions
                </div>
                <div class="chart-container" id="funding-chart"></div>
                <div class="chart-subtitle">% Reporting Sufficient Funding</div>
            </div>
        </div>
        
        <div class="sources">
            Sources: SETDA State EdTech Trends Report, GovTech, AI for Education (2023-2024)
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // Common variables
        const indigo = "#0A3D62";
        const emerald = "#1E8F7A";
        const alertRed = "#D64541";
        
        // Create tooltip
        const tooltip = d3.select("#tooltip");
        
        // Create legend for center panel first to ensure proper layout
        const legendContainer = d3.select("#equity-legend");
        
        const legendItems = [
            { label: "Broadband Initiatives", color: emerald },
            { label: "Unmet Training Needs", color: alertRed }
        ];
        
        legendItems.forEach(item => {
            const legendItem = legendContainer.append("div")
                .attr("class", "legend-item");
                
            legendItem.append("div")
                .attr("class", "legend-color")
                .style("background-color", item.color);
                
            legendItem.append("div")
                .text(item.label)
                .style("font-size", "10px");
        });
        
        // Left Panel: AI Policy Adoption
        const aiPolicyData = [
            { label: "Published AI Guidance", value: 25, isCount: true },
            { label: "Interest in AI", value: 92, isCount: false },
            { label: "Developing AI Guidance", value: 50, isCount: false }
        ];
        
        const aiPolicyWidth = document.getElementById("ai-policy-chart").clientWidth;
        const aiPolicyHeight = document.getElementById("ai-policy-chart").clientHeight;
        
        const aiPolicySvg = d3.select("#ai-policy-chart")
            .append("svg")
            .attr("width", aiPolicyWidth)
            .attr("height", aiPolicyHeight);
        
        // Create simplified labels for x-axis
        const simplifiedLabels = [
            "Published\nAI Guidance",
            "Interest\nin AI",
            "Developing\nAI Guidance"
        ];
        
        const aiPolicyX = d3.scaleBand()
            .domain(simplifiedLabels)
            .range([50, aiPolicyWidth - 20])
            .padding(0.4);
        
        const aiPolicyY = d3.scaleLinear()
            .domain([0, 100])
            .range([aiPolicyHeight - 60, 60]);
        
        // Add X axis with better text handling
        aiPolicySvg.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(0, ${aiPolicyHeight - 60})`)
            .call(d3.axisBottom(aiPolicyX))
            .selectAll("text")
            .style("text-anchor", "middle")
            .style("font-size", "9px")
            .call(function(selection) {
                selection.each(function(d) {
                    const text = d3.select(this);
                    const words = d.split('\n');
                    text.text('');
                    
                    words.forEach((word, i) => {
                        text.append("tspan")
                            .attr("x", 0)
                            .attr("dy", i === 0 ? "0em" : "1em")
                            .text(word);
                    });
                });
            });
        
        // Add Y axis
        aiPolicySvg.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(50, 0)`)
            .call(d3.axisLeft(aiPolicyY).ticks(5).tickFormat(d => d + "%"));
            
        // Add Y axis label
        aiPolicySvg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("y", 15)
            .attr("x", -(aiPolicyHeight / 2))
            .text("Percentage of States");
        
        // Add grid lines
        aiPolicySvg.append("g")
            .attr("class", "grid")
            .attr("transform", `translate(50, 0)`)
            .call(d3.axisLeft(aiPolicyY)
                .ticks(5)
                .tickSize(-(aiPolicyWidth - 70))
                .tickFormat(""));
        
        // Add bars
        aiPolicySvg.selectAll(".bar")
            .data(aiPolicyData)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", (d, i) => aiPolicyX(simplifiedLabels[i]))
            .attr("y", d => d.isCount ? aiPolicyY(d.value * 2) : aiPolicyY(d.value))
            .attr("width", aiPolicyX.bandwidth())
            .attr("height", d => d.isCount ? aiPolicyHeight - 60 - aiPolicyY(d.value * 2) : aiPolicyHeight - 60 - aiPolicyY(d.value))
            .attr("fill", indigo)
            .on("mouseover", function(event, d) {
                tooltip.style("opacity", 1)
                    .html(`${d.label}: <b>${d.value}${d.isCount ? " states" : "%"}</b>`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 20) + "px");
            })
            .on("mouseout", function() {
                tooltip.style("opacity", 0);
            });
        
        // Add value labels
        aiPolicySvg.selectAll(".value-label")
            .data(aiPolicyData)
            .enter()
            .append("text")
            .attr("class", "value-label")
            .attr("x", (d, i) => aiPolicyX(simplifiedLabels[i]) + aiPolicyX.bandwidth() / 2)
            .attr("y", d => d.isCount ? aiPolicyY(d.value * 2) - 8 : aiPolicyY(d.value) - 8)
            .attr("text-anchor", "middle")
            .html(d => `<tspan class="key-number">${d.value}</tspan>${d.isCount ? "" : "%"}`)
            .style("font-size", "10px")
            .style("fill", "#333");
        
        // Add US map icon with better integration
        aiPolicySvg.append("text")
            .attr("x", aiPolicyWidth / 2)
            .attr("y", 30)
            .attr("text-anchor", "middle")
            .attr("class", "fa")
            .style("font-family", "FontAwesome")
            .style("font-size", "16px")
            .style("fill", "#555")
            .text("\uf276"); // Map marker icon
            
        aiPolicySvg.append("text")
            .attr("x", aiPolicyWidth / 2)
            .attr("y", 45)
            .attr("text-anchor", "middle")
            .text("U.S. States")
            .style("font-size", "9px")
            .style("fill", "#555");
        
        // Center Panel: Digital Equity & Professional Development
        const digitalEquityData = [
            { metric: "Broadband/Digital Equity Initiatives", year: 2023, value: 71 },
            { metric: "Broadband/Digital Equity Initiatives", year: 2024, value: 85 },
            { metric: "Unmet Ed-Tech Training Needs", year: 2023, value: 17 },
            { metric: "Unmet Ed-Tech Training Needs", year: 2024, value: 24 }
        ];
        
        const digitalEquityWidth = document.getElementById("digital-equity-chart").clientWidth;
        const digitalEquityHeight = document.getElementById("digital-equity-chart").clientHeight;
        
        const digitalEquitySvg = d3.select("#digital-equity-chart")
            .append("svg")
            .attr("width", digitalEquityWidth)
            .attr("height", digitalEquityHeight);
        
        const digitalEquityX = d3.scalePoint()
            .domain([2023, 2024])
            .range([60, digitalEquityWidth - 30]);
        
        const digitalEquityY = d3.scaleLinear()
            .domain([0, 100])
            .range([digitalEquityHeight - 60, 40]);
        
        // Add X axis
        digitalEquitySvg.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(0, ${digitalEquityHeight - 60})`)
            .call(d3.axisBottom(digitalEquityX).tickFormat(d => d));
            
        // Add X axis label
        digitalEquitySvg.append("text")
            .attr("class", "axis-label")
            .attr("x", digitalEquityWidth / 2)
            .attr("y", digitalEquityHeight - 20)
            .text("Year");
        
        // Add Y axis
        digitalEquitySvg.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(60, 0)`)
            .call(d3.axisLeft(digitalEquityY).ticks(5).tickFormat(d => d + "%"));
            
        // Add Y axis label
        digitalEquitySvg.append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("y", 15)
            .attr("x", -(digitalEquityHeight / 2))
            .text("Percentage of States");
        
        // Add grid lines
        digitalEquitySvg.append("g")
            .attr("class", "grid")
            .attr("transform", `translate(60, 0)`)
            .call(d3.axisLeft(digitalEquityY)
                .ticks(5)
                .tickSize(-(digitalEquityWidth - 90))
                .tickFormat(""));
        
        // Create line generator for broadband initiatives
        const broadbandLine = d3.line()
            .x(d => digitalEquityX(d.year))
            .y(d => digitalEquityY(d.value));
        
        // Create line generator for unmet training needs
        const trainingLine = d3.line()
            .x(d => digitalEquityX(d.year))
            .y(d => digitalEquityY(d.value));
        
        // Filter data for each metric
        const broadbandData = digitalEquityData.filter(d => d.metric === "Broadband/Digital Equity Initiatives");
        const trainingData = digitalEquityData.filter(d => d.metric === "Unmet Ed-Tech Training Needs");
        
        // Add broadband line
        digitalEquitySvg.append("path")
            .datum(broadbandData)
            .attr("fill", "none")
            .attr("stroke", emerald)
            .attr("stroke-width", 2.5)
            .attr("d", broadbandLine);
        
        // Add training line
        digitalEquitySvg.append("path")
            .datum(trainingData)
            .attr("fill", "none")
            .attr("stroke", alertRed)
            .attr("stroke-width", 2.5)
            .attr("d", trainingLine);
        
        // Add data points for broadband with improved visibility
        digitalEquitySvg.selectAll(".broadband-point")
            .data(broadbandData)
            .enter()
            .append("circle")
            .attr("class", "broadband-point")
            .attr("cx", d => digitalEquityX(d.year))
            .attr("cy", d => digitalEquityY(d.value))
            .attr("r", 5)
            .attr("fill", "#fff")
            .attr("stroke", emerald)
            .attr("stroke-width", 2)
            .on("mouseover", function(event, d) {
                tooltip.style("opacity", 1)
                    .html(`${d.metric} (${d.year}): <b>${d.value}%</b>`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 20) + "px");
            })
            .on("mouseout", function() {
                tooltip.style("opacity", 0);
            });
        
        // Add data points for training with improved visibility
        digitalEquitySvg.selectAll(".training-point")
            .data(trainingData)
            .enter()
            .append("circle")
            .attr("class", "training-point")
            .attr("cx", d => digitalEquityX(d.year))
            .attr("cy", d => digitalEquityY(d.value))
            .attr("r", 5)
            .attr("fill", "#fff")
            .attr("stroke", alertRed)
            .attr("stroke-width", 2)
            .on("mouseover", function(event, d) {
                tooltip.style("opacity", 1)
                    .html(`${d.metric} (${d.year}): <b>${d.value}%</b>`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 20) + "px");
            })
            .on("mouseout", function() {
                tooltip.style("opacity", 0);
            });
        
        // Add value labels for broadband with better positioning
        digitalEquitySvg.selectAll(".broadband-label")
            .data(broadbandData)
            .enter()
            .append("text")
            .attr("class", "broadband-label")
            .attr("x", d => digitalEquityX(d.year))
            .attr("y", d => digitalEquityY(d.value) - 12)
            .attr("text-anchor", "middle")
            .html(d => `<tspan class="key-number">${d.value}%</tspan>`)
            .style("font-size", "10px")
            .style("fill", emerald);
        
        // Add value labels for training with better positioning
        digitalEquitySvg.selectAll(".training-label")
            .data(trainingData)
            .enter()
            .append("text")
            .attr("class", "training-label")
            .attr("x", d => digitalEquityX(d.year))
            .attr("y", d => digitalEquityY(d.value) - 12)
            .attr("text-anchor", "middle")
            .html(d => `<tspan class="key-number">${d.value}%</tspan>`)
            .style("font-size", "10px")
            .style("fill", alertRed);
        
        // Add callout boxes with better positioning
        const positiveCallout = d3.select("#digital-equity-panel")
            .append("div")
            .attr("class", "callout positive")
            .style("top", "130px")
            .style("right", "15px")
            .html('<i class="fas fa-arrow-up"></i> Significant increase in broadband initiatives from 71% to 85%');
        
        const negativeCallout = d3.select("#digital-equity-panel")
            .append("div")
            .attr("class", "callout negative")
            .style("bottom", "100px")
            .style("right", "15px")
            .html('<i class="fas fa-exclamation-triangle"></i> Concerning rise in unmet training needs from 17% to 24%');
        
        // Right Panel: Funding Sufficiency Perceptions
        const fundingData = [
            { category: "Cybersecurity", year: 2023, value: 19 },
            { category: "Cybersecurity", year: 2024, value: 8 },
            { category: "AI Implementation", year: null, value: 14 },
            { category: "Professional Development", year: null, value: 22 }
        ];
        
        const fundingWidth = document.getElementById("funding-chart").clientWidth;
        const fundingHeight = document.getElementById("funding-chart").clientHeight;
        
        const fundingSvg = d3.select("#funding-chart")
            .append("svg")
            .attr("width", fundingWidth)
            .attr("height", fundingHeight);
        
        // Create better category labels
        const categoryLabels = [
            "Cybersecurity (2023)",
            "Cybersecurity (2024)",
            "AI Implementation",
            "Professional Development"
        ];
        
        const fundingY = d3.scaleBand()
            .domain(categoryLabels)
            .range([60, fundingHeight - 60])
            .padding(0.3);
        
        // Adjust x-axis scale to provide more margin
        const fundingX = d3.scaleLinear()
            .domain([0, 30]) // Increased from 25 to 30 for more margin
            .range([100, fundingWidth - 20]);
        
        // Add Y axis with better label handling
        fundingSvg.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(100, 0)`)
            .call(d3.axisLeft(fundingY))
            .selectAll("text")
            .style("font-size", "9px")
            .attr("x", -5)
            .call(function(selection) {
                selection.each(function(d) {
                    const text = d3.select(this);
                    
                    if (d.includes("Cybersecurity")) {
                        text.text(d.includes("2023") ? "Cybersecurity (2023)" : "Cybersecurity (2024)");
                    } else if (d.includes("AI")) {
                        text.text("AI Implementation");
                    } else {
                        text.text("Professional Development");
                    }
                });
            });
        
        // Add X axis
        fundingSvg.append("g")
            .attr("class", "axis")
            .attr("transform", `translate(0, ${fundingHeight - 60})`)
            .call(d3.axisBottom(fundingX).ticks(5).tickFormat(d => d + "%"));
            
        // Add X axis label
        fundingSvg.append("text")
            .attr("class", "axis-label")
            .attr("x", fundingWidth / 2)
            .attr("y", fundingHeight - 20)
            .text("Percentage");
        
        // Add grid lines
        fundingSvg.append("g")
            .attr("class", "grid")
            .attr("transform", `translate(100, 0)`)
            .call(d3.axisLeft(fundingY)
                .tickSize(-(fundingWidth - 120))
                .tickFormat(""));
        
        // Add bars with better data representation
        const barData = [
            { category: "Cybersecurity (2023)", value: 19 },
            { category: "Cybersecurity (2024)", value: 8 },
            { category: "AI Implementation", value: 14 },
            { category: "Professional Development", value: 22 }
        ];
        
        fundingSvg.selectAll(".funding-bar")
            .data(barData)
            .enter()
            .append("rect")
            .attr("class", "funding-bar")
            .attr("x", 100)
            .attr("y", d => fundingY(d.category))
            .attr("width", d => fundingX(d.value) - 100)
            .attr("height", fundingY.bandwidth())
            .attr("fill", alertRed)
            .on("mouseover", function(event, d) {
                tooltip.style("opacity", 1)
                    .html(`${d.category}: <b>${d.value}%</b>`)
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 20) + "px");
            })
            .on("mouseout", function() {
                tooltip.style("opacity", 0);
            });
        
        // Add value labels
        fundingSvg.selectAll(".funding-label")
            .data(barData)
            .enter()
            .append("text")
            .attr("class", "funding-label")
            .attr("x", d => fundingX(d.value) + 5)
            .attr("y", d => fundingY(d.category) + fundingY.bandwidth() / 2 + 4)
            .html(d => `<tspan class="key-number">${d.value}%</tspan>`)
            .style("font-size", "10px")
            .style("fill", "#333");
        
        // Add downward arrow between cybersecurity bars with better positioning
        fundingSvg.append("text")
            .attr("x", fundingX(14)) // Positioned between the two values
            .attr("y", fundingY("Cybersecurity (2023)") + fundingY.bandwidth() + 12)
            .attr("text-anchor", "middle")
            .attr("class", "fa")
            .style("font-family", "FontAwesome")
            .style("font-size", "14px")
            .style("fill", alertRed)
            .text("\uf063"); // Down arrow icon
    </script>
</body>
</html>