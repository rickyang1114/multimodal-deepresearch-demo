<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Senior Population and Housing Penetration</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f9f9f9;
        }
        
        .visualization-container {
            width: 900px;
            height: 650px;
            background-color: white;
            padding: 20px;
        }
        
        .main-title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 30px;
            color: #333;
        }
        
        .chart-container {
            display: flex;
            justify-content: space-between;
            height: 500px;
        }
        
        .panel {
            width: 48%;
        }
        
        .panel-title {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #444;
        }
        
        .source {
            text-align: left;
            font-size: 11px;
            color: #888;
            margin-top: 20px;
        }
        
        .key-number {
            font-family: 'Georgia', serif;
            font-weight: bold;
            color: #002D62;
        }
        
        .growth-arrow {
            fill: none;
            stroke: #002D62;
            stroke-width: 2;
        }
        
        .growth-label {
            font-weight: bold;
            fill: #002D62;
        }
        
        .threshold-line {
            stroke: #666;
            stroke-width: 1.5;
            stroke-dasharray: 4, 4;
        }
        
        .annotation {
            font-size: 11px;
            font-style: italic;
            fill: #666;
        }
        
        .threshold-label {
            font-size: 12px;
            fill: #666;
        }
        
        @media (max-width: 950px) {
            .visualization-container {
                width: 95%;
                height: auto;
            }
            
            .chart-container {
                flex-direction: column;
                height: auto;
            }
            
            .panel {
                width: 100%;
                margin-bottom: 30px;
                height: 350px;
            }
        }
    </style>
</head>
<body>
    <div class="visualization-container">
        <div class="main-title">Global senior population is surging while housing supply remains critically low</div>
        
        <div class="chart-container">
            <div class="panel" id="left-panel">
                <div class="panel-title">Global 65+ Population (billions)</div>
                <svg id="population-chart" width="100%" height="90%"></svg>
            </div>
            
            <div class="panel" id="right-panel">
                <div class="panel-title">Senior Housing Penetration Rate by Market (%)</div>
                <svg id="penetration-chart" width="100%" height="90%"></svg>
            </div>
        </div>
        
        <div class="source">Source: UN World Social Report 2023; McKinsey analysis</div>
    </div>

    <script>
        // Left panel: Population chart
        const populationSvg = d3.select("#population-chart");
        const populationWidth = populationSvg.node().getBoundingClientRect().width;
        const populationHeight = populationSvg.node().getBoundingClientRect().height;
        const populationMargin = {top: 40, right: 30, bottom: 50, left: 50};
        const populationChartWidth = populationWidth - populationMargin.left - populationMargin.right;
        const populationChartHeight = populationHeight - populationMargin.top - populationMargin.bottom;
        
        const populationData = [
            {year: "2021", value: 0.746},
            {year: "2050", value: 1.6}
        ];
        
        const populationG = populationSvg.append("g")
            .attr("transform", `translate(${populationMargin.left}, ${populationMargin.top})`);
        
        // X scale
        const populationX = d3.scaleBand()
            .domain(populationData.map(d => d.year))
            .range([0, populationChartWidth])
            .padding(0.3);
        
        // Y scale
        const populationY = d3.scaleLinear()
            .domain([0, 2.0])
            .range([populationChartHeight, 0]);
        
        // Add X axis
        populationG.append("g")
            .attr("transform", `translate(0, ${populationChartHeight})`)
            .call(d3.axisBottom(populationX))
            .selectAll("text")
            .style("font-size", "12px");
        
        // Add Y axis
        populationG.append("g")
            .call(d3.axisLeft(populationY)
                .ticks(5)
                .tickFormat(d => d.toFixed(1) + "B"))
            .selectAll("text")
            .style("font-size", "12px");
        
        // Add gridlines
        populationG.selectAll("y-gridlines")
            .data(populationY.ticks(5))
            .enter()
            .append("line")
            .attr("x1", 0)
            .attr("x2", populationChartWidth)
            .attr("y1", d => populationY(d))
            .attr("y2", d => populationY(d))
            .attr("stroke", "#e0e0e0")
            .attr("stroke-width", 1);
        
        // Add bars
        populationG.selectAll(".bar")
            .data(populationData)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", d => populationX(d.year))
            .attr("y", d => populationY(d.value))
            .attr("width", populationX.bandwidth())
            .attr("height", d => populationChartHeight - populationY(d.value))
            .attr("fill", "#002D62");
        
        // Add data labels
        populationG.selectAll(".label")
            .data(populationData)
            .enter()
            .append("text")
            .attr("class", "key-number")
            .attr("x", d => populationX(d.year) + populationX.bandwidth() / 2)
            .attr("y", d => populationY(d.value) - 10)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .text(d => d.year === "2021" ? "0.75B" : "1.60B");
        
        // Add growth arrow
        const startX = populationX("2021") + populationX.bandwidth() / 2;
        const endX = populationX("2050") + populationX.bandwidth() / 2;
        const startY = populationY(0.746) + 30;
        const endY = populationY(1.6) - 30;
        
        populationG.append("path")
            .attr("d", `M${startX},${startY} C${startX + 40},${(startY + endY) / 2} ${endX - 40},${(startY + endY) / 2} ${endX},${endY}`)
            .attr("stroke", "#002D62")
            .attr("stroke-width", 2)
            .attr("fill", "none")
            .attr("marker-end", "url(#arrowhead)");
            
        // Add arrowhead definition
        populationSvg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 5)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5")
            .attr("fill", "#002D62");
        
        // Add growth label
        populationG.append("text")
            .attr("class", "growth-label")
            .attr("x", (startX + endX) / 2)
            .attr("y", (startY + endY) / 2 - 15)
            .attr("text-anchor", "middle")
            .style("font-size", "16px")
            .style("font-weight", "bold")
            .style("fill", "#002D62")
            .text("+115%");
        
        // Right panel: Penetration chart
        const penetrationSvg = d3.select("#penetration-chart");
        const penetrationWidth = penetrationSvg.node().getBoundingClientRect().width;
        const penetrationHeight = penetrationSvg.node().getBoundingClientRect().height;
        const penetrationMargin = {top: 40, right: 80, bottom: 60, left: 160};
        const penetrationChartWidth = penetrationWidth - penetrationMargin.left - penetrationMargin.right;
        const penetrationChartHeight = penetrationHeight - penetrationMargin.top - penetrationMargin.bottom;
        
        const penetrationData = [
            {region: "Australia/Canada/NZ/US", value: 5},
            {region: "UK", value: 1},
            {region: "Europe", value: 1},
            {region: "Japan", value: 1}
        ];
        
        const penetrationG = penetrationSvg.append("g")
            .attr("transform", `translate(${penetrationMargin.left}, ${penetrationMargin.top})`);
        
        // X scale - explicitly set to 6% max
        const penetrationX = d3.scaleLinear()
            .domain([0, 6])
            .range([0, penetrationChartWidth]);
        
        // Y scale
        const penetrationY = d3.scaleBand()
            .domain(penetrationData.map(d => d.region))
            .range([0, penetrationChartHeight])
            .padding(0.3);
        
        // Add X axis
        penetrationG.append("g")
            .attr("transform", `translate(0, ${penetrationChartHeight})`)
            .call(d3.axisBottom(penetrationX)
                .ticks(6)
                .tickFormat(d => d + "%"))
            .selectAll("text")
            .style("font-size", "12px");
        
        // Add Y axis
        penetrationG.append("g")
            .call(d3.axisLeft(penetrationY))
            .selectAll("text")
            .style("font-size", "12px");
        
        // Add gridlines
        penetrationG.selectAll("x-gridlines")
            .data(penetrationX.ticks(6))
            .enter()
            .append("line")
            .attr("x1", d => penetrationX(d))
            .attr("x2", d => penetrationX(d))
            .attr("y1", 0)
            .attr("y2", penetrationChartHeight)
            .attr("stroke", "#e0e0e0")
            .attr("stroke-width", 1);
        
        // Add bars
        penetrationG.selectAll(".bar")
            .data(penetrationData)
            .enter()
            .append("rect")
            .attr("class", "bar")
            .attr("x", 0)
            .attr("y", d => penetrationY(d.region))
            .attr("width", d => penetrationX(d.value))
            .attr("height", penetrationY.bandwidth())
            .attr("fill", "#008080");
        
        // Add data labels
        penetrationG.selectAll(".label")
            .data(penetrationData)
            .enter()
            .append("text")
            .attr("x", d => penetrationX(d.value) + 5)
            .attr("y", d => penetrationY(d.region) + penetrationY.bandwidth() / 2 + 5)
            .style("font-size", "14px")
            .style("font-family", "Georgia, serif")
            .style("font-weight", "bold")
            .style("fill", "#002D62")
            .text(d => d.region === "Australia/Canada/NZ/US" ? "5%" : "<1%");
        
        // Add threshold line at 5%
        penetrationG.append("line")
            .attr("class", "threshold-line")
            .attr("x1", penetrationX(5))
            .attr("x2", penetrationX(5))
            .attr("y1", 0)
            .attr("y2", penetrationChartHeight)
            .attr("stroke", "#666")
            .attr("stroke-width", 1.5)
            .attr("stroke-dasharray", "4,4");
            
        // Add threshold label
        penetrationG.append("text")
            .attr("class", "threshold-label")
            .attr("x", penetrationX(5))
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .text("5% threshold");
        
        // Add annotation with better positioning
        penetrationG.append("text")
            .attr("class", "annotation")
            .attr("x", penetrationX(3))
            .attr("y", penetrationChartHeight + 40)
            .attr("text-anchor", "middle")
            .text("Even in mature markets, penetration remains low");
    </script>
</body>
</html>