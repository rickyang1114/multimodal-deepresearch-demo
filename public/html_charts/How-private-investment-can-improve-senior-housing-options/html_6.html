<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telemedicine & Remote Monitoring Impact</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f9f9f9;
        }
        
        .visualization-container {
            width: 900px;
            background-color: white;
            padding: 20px;
        }
        
        .title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 25px;
        }
        
        .section-header {
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
            margin-bottom: 10px;
            border-bottom: 1px solid #999;
            padding-bottom: 5px;
        }
        
        .metric-name {
            font-size: 14px;
            text-anchor: end;
        }
        
        .value-label {
            font-size: 12px;
        }
        
        .improvement {
            font-weight: bold;
            font-size: 14px;
        }
        
        .improvement-value {
            font-family: 'Georgia', serif;
            font-size: 16px;
            font-weight: bold;
        }
        
        .source {
            font-size: 11px;
            color: #777;
            text-align: center;
            margin-top: 15px;
        }
        
        .callout {
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            font-size: 14px;
            line-height: 1.4;
        }
        
        .callout-highlight {
            font-weight: bold;
            color: #E67E22;
        }
        
        .p-value {
            font-size: 10px;
            font-style: italic;
            fill: #777;
        }
        
        .grid-line {
            stroke: #eee;
            stroke-width: 1;
        }
        
        .legend {
            font-size: 12px;
        }
        
        .x-axis text {
            font-size: 10px;
        }
        
        .x-axis path {
            stroke: #ddd;
        }
        
        .arrow-up {
            fill: green;
        }
        
        .arrow-down {
            fill: green;
        }
    </style>
</head>
<body>
    <div class="visualization-container">
        <div id="chart"></div>
    </div>

    <script>
        // Data preparation
        const data = {
            "Clinical Outcomes": [
                {
                    name: "Disease-specific markers",
                    before: 12000,
                    beforeError: 1500,
                    after: 11000,
                    afterError: 1800,
                    improvement: 8.3,
                    better: "decrease",
                    pValue: "p < 0.05"
                },
                {
                    name: "Symptom severity scores",
                    before: 3500,
                    beforeError: 1200,
                    after: 2000,
                    afterError: 800,
                    improvement: 42.9,
                    better: "decrease",
                    pValue: "p < 0.01"
                },
                {
                    name: "Overall health status",
                    before: 7200,
                    beforeError: 1500,
                    after: 8500,
                    afterError: 1000,
                    improvement: 18.1,
                    better: "increase",
                    pValue: "p < 0.05"
                }
            ],
            "Economic Impact": [
                {
                    name: "Direct healthcare costs",
                    before: 25000,
                    after: 12000,
                    improvement: 52.0,
                    better: "decrease",
                    pValue: "p < 0.001"
                },
                {
                    name: "Indirect costs (productivity loss)",
                    before: 10000,
                    after: 5000,
                    improvement: 50.0,
                    better: "decrease",
                    pValue: "p < 0.001"
                }
            ],
            "Patient/Provider Experience": [
                {
                    name: "Patient communication satisfaction",
                    before: 80,
                    after: 95,
                    improvement: 18.8,
                    better: "increase",
                    pValue: "p < 0.05"
                },
                {
                    name: "Service convenience",
                    before: 75,
                    after: 90,
                    improvement: 20.0,
                    better: "increase",
                    pValue: "p < 0.05"
                },
                {
                    name: "Overall experience",
                    before: 85,
                    after: 92,
                    improvement: 8.2,
                    better: "increase",
                    pValue: "p < 0.1"
                },
                {
                    name: "Provider satisfaction",
                    before: 80,
                    after: 95,
                    improvement: 18.8,
                    better: "increase",
                    pValue: "p < 0.05"
                }
            ]
        };

        // Section colors
        const sectionColors = {
            "Clinical Outcomes": "#002D62",
            "Economic Impact": "#008080",
            "Patient/Provider Experience": "#E67E22"
        };

        // Set up the SVG
        const margin = {top: 60, right: 180, bottom: 50, left: 250};
        const width = 900 - margin.left - margin.right;
        const height = 650 - margin.top - margin.bottom;

        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Add title
        svg.append("text")
            .attr("class", "title")
            .attr("x", width / 2)
            .attr("y", -30)
            .attr("text-anchor", "middle")
            .text("Telemedicine & Remote Monitoring: Clinical and Economic Impact");

        // Add legend
        const legend = svg.append("g")
            .attr("class", "legend")
            .attr("transform", `translate(${width - 100}, -45)`);
            
        legend.append("rect")
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", 12)
            .attr("height", 12)
            .attr("fill", "#D3D3D3");
            
        legend.append("text")
            .attr("x", 18)
            .attr("y", 10)
            .text("Before");
            
        legend.append("rect")
            .attr("x", 80)
            .attr("y", 0)
            .attr("width", 12)
            .attr("height", 12)
            .attr("fill", "#002D62");
            
        legend.append("text")
            .attr("x", 98)
            .attr("y", 10)
            .text("After");

        // Calculate total metrics and spacing
        const sections = Object.keys(data);
        const totalMetrics = sections.reduce((sum, section) => sum + data[section].length, 0);
        const sectionSpacing = 40;
        const metricHeight = (height - (sections.length - 1) * sectionSpacing) / totalMetrics;

        // Create scales for each section
        let currentY = 0;
        sections.forEach((section, sectionIndex) => {
            const metrics = data[section];
            
            // Add section header
            svg.append("text")
                .attr("class", "section-header")
                .attr("x", -margin.left + 20)
                .attr("y", currentY - 15)
                .text(section);
            
            // Find max value for this section
            let maxValue;
            if (section === "Patient/Provider Experience") {
                maxValue = 100; // Fixed scale for percentages
            } else {
                maxValue = d3.max(metrics, d => Math.max(d.before, d.after)) * 1.2; // Increased scale by 20% for better spacing
            }
            
            // Create scale for this section
            const xScale = d3.scaleLinear()
                .domain([0, maxValue])
                .range([0, width]);
            
            // Add x-axis for this section
            const xAxis = d3.axisBottom(xScale)
                .ticks(5)
                .tickSize(-2);
            
            svg.append("g")
                .attr("class", "x-axis")
                .attr("transform", `translate(0,${currentY + metrics.length * metricHeight + 5})`)
                .call(xAxis)
                .call(g => g.select(".domain").attr("stroke", "#ddd"));
            
            // Add metrics for this section
            metrics.forEach((metric, i) => {
                const y = currentY + i * metricHeight + metricHeight / 2;
                
                // Add grid line
                svg.append("line")
                    .attr("class", "grid-line")
                    .attr("x1", 0)
                    .attr("y1", y)
                    .attr("x2", width)
                    .attr("y2", y);
                
                // Add metric name
                svg.append("text")
                    .attr("class", "metric-name")
                    .attr("x", -15)
                    .attr("y", y)
                    .attr("dy", "0.35em")
                    .attr("text-anchor", "end")
                    .text(metric.name);
                
                // Add before bar
                svg.append("rect")
                    .attr("x", 0)
                    .attr("y", y - metricHeight / 3 - 2) // Added spacing between bars
                    .attr("width", xScale(metric.before))
                    .attr("height", metricHeight / 3)
                    .attr("fill", "#D3D3D3");
                
                // Add after bar
                svg.append("rect")
                    .attr("x", 0)
                    .attr("y", y + 2) // Added spacing between bars
                    .attr("width", xScale(metric.after))
                    .attr("height", metricHeight / 3)
                    .attr("fill", sectionColors[section]);
                
                // Add before label with improved positioning
                const beforeLabelX = xScale(metric.before) + 5;
                const beforeLabelY = y - metricHeight / 3 + 2;
                
                svg.append("text")
                    .attr("class", "value-label")
                    .attr("x", beforeLabelX)
                    .attr("y", beforeLabelY)
                    .attr("dy", "0.35em")
                    .text(() => {
                        if (section === "Patient/Provider Experience") {
                            return metric.before + "%";
                        } else {
                            return "₹" + d3.format(",")(metric.before);
                        }
                    });
                
                // Add after label with improved positioning
                const afterLabelX = xScale(metric.after) + 5;
                const afterLabelY = y + metricHeight / 3 + 2;
                
                svg.append("text")
                    .attr("class", "value-label")
                    .attr("x", afterLabelX)
                    .attr("y", afterLabelY)
                    .attr("dy", "0.35em")
                    .text(() => {
                        if (section === "Patient/Provider Experience") {
                            return metric.after + "%";
                        } else {
                            return "₹" + d3.format(",")(metric.after);
                        }
                    });
                
                // Add improvement with proper arrow and positioning
                const improvementX = Math.max(xScale(metric.before), xScale(metric.after)) + 70;
                
                // Create the arrow based on better direction
                const arrowSymbol = metric.better === "increase" ? "↑" : "↓";
                const arrowColor = metric.better === "decrease" ? "green" : "green";
                
                svg.append("text")
                    .attr("class", "improvement")
                    .attr("x", improvementX)
                    .attr("y", y)
                    .attr("dy", "0.35em")
                    .html(`<tspan style="fill: ${arrowColor};">${arrowSymbol}</tspan> <tspan class="improvement-value">${metric.improvement}%</tspan>`);
                
                // Add p-value with better positioning
                svg.append("text")
                    .attr("class", "p-value")
                    .attr("x", 0)
                    .attr("y", y + metricHeight / 2 + 8)
                    .text(metric.pValue);
            });
            
            currentY += metrics.length * metricHeight + sectionSpacing;
        });

        // Add source information
        svg.append("text")
            .attr("class", "source")
            .attr("x", width / 2)
            .attr("y", height + 30)
            .attr("text-anchor", "middle")
            .text("Source: Vudathaneni et al. 2024; prospective observational study of 186 chronic-disease patients across U.S. and Indian facilities");

        // Add callout box in a better position
        const calloutX = width - 220;
        const calloutY = 50;
        const calloutWidth = 220;
        const calloutHeight = 100;
        
        svg.append("foreignObject")
            .attr("x", calloutX)
            .attr("y", calloutY)
            .attr("width", calloutWidth)
            .attr("height", calloutHeight)
            .append("xhtml:div")
            .attr("class", "callout")
            .html("Telemedicine and remote monitoring <span class='callout-highlight'>cut healthcare costs in half</span> while improving clinical outcomes and satisfaction");
    </script>
</body>
</html>